{"version":3,"sources":["controllers/devices.js"],"names":["define","loading","dom","libraryMenu","globalize","imageHelper","canDelete","deviceId","ApiClient","showDeviceMenu","view","btn","menuItems","canEdit","push","name","translate","id","icon","require","actionsheet","show","items","positionTo","callback","Dashboard","navigate","deleteDevice","page","msg","confirm","text","title","confirmText","primary","then","ajax","type","url","getUrl","Id","loadData","getJSON","result","load","devices","html","map","device","deviceHtml","iconUrl","getDeviceIcon","Name","AppName","AppVersion","LastUserName","humaneDate","DateLastActivity","join","querySelector","innerHTML","Items","hide","isMinServerVersion","params","addEventListener","e","btnDeviceMenu","parentWithClass","target","getAttribute","this"],"mappings":"AAAA,aAAAA,OAAO,CAAC,UAAW,MAAO,cAAe,YAAa,sBAAuB,aAAc,cAAe,sBAAuB,cAAc,SAAUC,QAASC,IAAKC,YAAaC,UAAWC,aAG3L,SAASC,UAAUC,UACf,OAAOA,WAAaC,UAAUD,WA0BlC,SAASE,eAAeC,KAAMC,IAAKJ,UAC/B,IAAIK,UAAY,GAEZC,SACAD,UAAUE,KAAK,CACXC,KAAMX,UAAUY,UAAU,QAC1BC,GAAI,OACJC,KAAM,cAIVZ,UAAUC,WACVK,UAAUE,KAAK,CACXC,KAAMX,UAAUY,UAAU,UAC1BC,GAAI,SACJC,KAAM,WAIdC,QAAQ,CAAC,gBAAgB,SAAUC,aAC/BA,YAAYC,KAAK,CACbC,MAAOV,UACPW,WAAYZ,IACZa,SAAU,SAAAA,SAAUP,IAChB,OAAQA,IACJ,IAAK,OACDQ,UAAUC,SAAS,kBAAoBnB,UACvC,MAEJ,IAAK,UApDzB,SAASoB,aAAaC,KAAMX,IACxB,IAAIY,IAAMzB,UAAUY,UAAU,4BAE9BG,QAAQ,CAAC,YAAY,SAAUW,SAC3BA,QAAQ,CACJC,KAAMF,IACNG,MAAO5B,UAAUY,UAAU,sBAC3BiB,YAAa7B,UAAUY,UAAU,gBACjCkB,QAAS,WACVC,MAAK,WACJlC,QAAQoB,OACRb,UAAU4B,KAAK,CACXC,KAAM,SACNC,IAAK9B,UAAU+B,OAAO,UAAW,CAC7BC,GAAIvB,OAETkB,MAAK,WACJM,SAASb,eAoCDD,CAAajB,KAAMH,iBA0D3C,SAASkC,SAASb,MACd3B,QAAQoB,OACRb,UAAUkC,QAAQlC,UAAU+B,OAAO,YAAYJ,MAAK,SAAUQ,SArDlE,SAASC,KAAKhB,KAAMiB,SAChB,IAAIC,KAAO,GACXA,MAAQD,QAAQE,KAAI,SAAUC,QAC1B,IAAIC,WAAa,GACjBA,YAAc,iBAAmBD,OAAOR,GAAK,+BAC7CS,YAAc,sCACdA,YAAc,6BACdA,YAAc,qDACdA,YAAc,kCAAoCpC,QAAU,kBAAoBmC,OAAOR,GAAK,KAAO,4CACnG,IAAIU,QAAU7C,YAAY8C,cAAcH,QAqCxC,OAnCIE,SACAD,YAAc,wDAA0DC,QAAU,qEAClFD,YAAc,UAEdA,YAAc,8DAGlBA,YAAc,OACdA,YAAc,SACdA,YAAc,4BAEVpC,SAAWP,UAAU0C,OAAOR,OAC5BS,YAAc,+DACdA,YAAc,+DAAiED,OAAOR,GAAK,YAAcpC,UAAUY,UAAU,QAAU,6EACvIiC,YAAc,UAGlBA,YAAc,yBACdA,YAAcD,OAAOI,KACrBH,YAAc,SACdA,YAAc,4CACdA,YAAcD,OAAOK,QAAU,IAAML,OAAOM,WAC5CL,YAAc,SACdA,YAAc,4CAEVD,OAAOO,eACPN,YAAcD,OAAOO,aACrBN,YAAc,KAAOO,WAAWR,OAAOS,mBAG3CR,YAAc,SACdA,YAAc,SACdA,YAAc,SACdA,YAAc,SACdA,YAAc,YAEfS,KAAK,IACR9B,KAAK+B,cAAc,gBAAgBC,UAAYd,KAM3CF,CAAKhB,KAAMe,OAAOkB,OAClB5D,QAAQ6D,UAIhB,IAAIjD,QAAUL,UAAUuD,mBAAmB,YAC3C,OAAO,SAAUrD,KAAMsD,QACnBtD,KAAKiD,cAAc,gBAAgBM,iBAAiB,SAAS,SAAUC,GACnE,IAAIC,cAAgBjE,IAAIkE,gBAAgBF,EAAEG,OAAQ,iBAE9CF,eACA1D,eAAeC,KAAMyD,cAAeA,cAAcG,aAAa,eAGvE5D,KAAKuD,iBAAiB,YAAY,WAC9BxB,SAAS8B","file":"devices.js","sourcesContent":["define([\"loading\", \"dom\", \"libraryMenu\", \"globalize\", \"scripts/imagehelper\", \"humanedate\", \"emby-button\", \"emby-itemscontainer\", \"cardStyle\"], function (loading, dom, libraryMenu, globalize, imageHelper) {\n    \"use strict\";\n\n    function canDelete(deviceId) {\n        return deviceId !== ApiClient.deviceId();\n    }\n\n    function deleteDevice(page, id) {\n        var msg = globalize.translate(\"DeleteDeviceConfirmation\");\n\n        require([\"confirm\"], function (confirm) {\n            confirm({\n                text: msg,\n                title: globalize.translate(\"HeaderDeleteDevice\"),\n                confirmText: globalize.translate(\"ButtonDelete\"),\n                primary: \"delete\"\n            }).then(function () {\n                loading.show();\n                ApiClient.ajax({\n                    type: \"DELETE\",\n                    url: ApiClient.getUrl(\"Devices\", {\n                        Id: id\n                    })\n                }).then(function () {\n                    loadData(page);\n                });\n            });\n        });\n    }\n\n    function showDeviceMenu(view, btn, deviceId) {\n        var menuItems = [];\n\n        if (canEdit) {\n            menuItems.push({\n                name: globalize.translate(\"Edit\"),\n                id: \"open\",\n                icon: \"mode_edit\"\n            });\n        }\n\n        if (canDelete(deviceId)) {\n            menuItems.push({\n                name: globalize.translate(\"Delete\"),\n                id: \"delete\",\n                icon: \"delete\"\n            });\n        }\n\n        require([\"actionsheet\"], function (actionsheet) {\n            actionsheet.show({\n                items: menuItems,\n                positionTo: btn,\n                callback: function (id) {\n                    switch (id) {\n                        case \"open\":\n                            Dashboard.navigate(\"device.html?id=\" + deviceId);\n                            break;\n\n                        case \"delete\":\n                            deleteDevice(view, deviceId);\n                    }\n                }\n            });\n        });\n    }\n\n    function load(page, devices) {\n        var html = \"\";\n        html += devices.map(function (device) {\n            var deviceHtml = \"\";\n            deviceHtml += \"<div data-id='\" + device.Id + \"' class='card backdropCard'>\";\n            deviceHtml += '<div class=\"cardBox visualCardBox\">';\n            deviceHtml += '<div class=\"cardScalable\">';\n            deviceHtml += '<div class=\"cardPadder cardPadder-backdrop\"></div>';\n            deviceHtml += '<a is=\"emby-linkbutton\" href=\"' + (canEdit ? \"device.html?id=\" + device.Id : \"#\") + '\" class=\"cardContent cardImageContainer\">';\n            var iconUrl = imageHelper.getDeviceIcon(device);\n\n            if (iconUrl) {\n                deviceHtml += '<div class=\"cardImage\" style=\"background-image:url(\\'' + iconUrl + \"');background-size: auto 64%;background-position:center center;\\\">\";\n                deviceHtml += \"</div>\";\n            } else {\n                deviceHtml += '<i class=\"cardImageIcon material-icons tablet_android\"></i>';\n            }\n\n            deviceHtml += \"</a>\";\n            deviceHtml += \"</div>\";\n            deviceHtml += '<div class=\"cardFooter\">';\n\n            if (canEdit || canDelete(device.Id)) {\n                deviceHtml += '<div style=\"text-align:right; float:right;padding-top:5px;\">';\n                deviceHtml += '<button type=\"button\" is=\"paper-icon-button-light\" data-id=\"' + device.Id + '\" title=\"' + globalize.translate(\"Menu\") + '\" class=\"btnDeviceMenu\"><i class=\"material-icons more_horiz\"></i></button>';\n                deviceHtml += \"</div>\";\n            }\n\n            deviceHtml += \"<div class='cardText'>\";\n            deviceHtml += device.Name;\n            deviceHtml += \"</div>\";\n            deviceHtml += \"<div class='cardText cardText-secondary'>\";\n            deviceHtml += device.AppName + \" \" + device.AppVersion;\n            deviceHtml += \"</div>\";\n            deviceHtml += \"<div class='cardText cardText-secondary'>\";\n\n            if (device.LastUserName) {\n                deviceHtml += device.LastUserName;\n                deviceHtml += \", \" + humaneDate(device.DateLastActivity);\n            }\n\n            deviceHtml += \"&nbsp;\";\n            deviceHtml += \"</div>\";\n            deviceHtml += \"</div>\";\n            deviceHtml += \"</div>\";\n            deviceHtml += \"</div>\";\n            return deviceHtml;\n        }).join(\"\");\n        page.querySelector(\".devicesList\").innerHTML = html;\n    }\n\n    function loadData(page) {\n        loading.show();\n        ApiClient.getJSON(ApiClient.getUrl(\"Devices\")).then(function (result) {\n            load(page, result.Items);\n            loading.hide();\n        });\n    }\n\n    var canEdit = ApiClient.isMinServerVersion(\"3.4.1.31\");\n    return function (view, params) {\n        view.querySelector(\".devicesList\").addEventListener(\"click\", function (e) {\n            var btnDeviceMenu = dom.parentWithClass(e.target, \"btnDeviceMenu\");\n\n            if (btnDeviceMenu) {\n                showDeviceMenu(view, btnDeviceMenu, btnDeviceMenu.getAttribute(\"data-id\"));\n            }\n        });\n        view.addEventListener(\"viewshow\", function () {\n            loadData(this);\n        });\n    };\n});\n"]}