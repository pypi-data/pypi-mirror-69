{"version":3,"sources":["components/lazyloader/lazyloader-scroll.js"],"names":["define","visibleinviewport","dom","browser","thresholdX","thresholdY","window","requestIdleCallback","resetThresholds","screen","availWidth","availHeight","resetThresholdsOnTimer","setTimeout","isVisible","elem","iOS","addEventListener","passive","wheelEvent","document","implementation","hasFeature","unveilElementsInternal","instance","callback","unveiledElements","cancellationTokens","loadedCount","unveil","cancelAll","tokens","i","length","index","unveilInternal","tokenIndex","anyFound","out","elements","removeEventListener","capture","LazyLoader","options","this","prototype","createObserver","observer","addElements","push","destroyObserver","destroy","lazyChildren","unveilElements","root","getElementsByClassName"],"mappings":"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","file":"lazyloader-scroll.js","sourcesContent":["define(['visibleinviewport', 'dom', 'browser'], function (visibleinviewport, dom, browser) {\n    'use strict';\n\n    var thresholdX;\n    var thresholdY;\n\n    var requestIdleCallback = window.requestIdleCallback || function (fn) {\n        fn();\n    };\n\n    function resetThresholds() {\n\n        var threshold = 0.3;\n\n        thresholdX = screen.availWidth * threshold;\n        thresholdY = screen.availHeight * threshold;\n    }\n\n    function resetThresholdsOnTimer() {\n\n        setTimeout(resetThresholds, 500);\n    }\n\n    if (browser.iOS) {\n        dom.addEventListener(window, \"orientationchange\", resetThresholdsOnTimer, { passive: true });\n        dom.addEventListener(window, 'resize', resetThresholdsOnTimer, { passive: true });\n    } else {\n        dom.addEventListener(window, \"orientationchange\", resetThresholds, { passive: true });\n        dom.addEventListener(window, 'resize', resetThresholds, { passive: true });\n    }\n    resetThresholds();\n\n    function isVisible(elem) {\n        return visibleinviewport(elem, true, thresholdX, thresholdY);\n    }\n\n    var wheelEvent = (document.implementation.hasFeature('Event.wheel', '3.0') ? 'wheel' : 'mousewheel');\n    var self = {};\n\n    function cancelAll(tokens) {\n        for (var i = 0, length = tokens.length; i < length; i++) {\n\n            tokens[i] = true;\n        }\n    }\n\n    function unveilElementsInternal(instance, callback) {\n\n        var unveiledElements = [];\n        var cancellationTokens = [];\n        var loadedCount = 0;\n\n        function unveilInternal(tokenIndex) {\n\n            var anyFound = false;\n            var out = false;\n\n            var elements = instance.elements;\n            // TODO: This out construct assumes left to right, top to bottom\n\n            for (var i = 0, length = elements.length; i < length; i++) {\n\n                if (cancellationTokens[tokenIndex]) {\n                    return;\n                }\n                if (unveiledElements[i]) {\n                    continue;\n                }\n                var elem = elements[i];\n                if (!out && isVisible(elem)) {\n                    anyFound = true;\n                    unveiledElements[i] = true;\n                    callback(elem);\n                    loadedCount++;\n                } else {\n\n                    if (anyFound) {\n                        out = true;\n                    }\n                }\n            }\n\n            if (loadedCount >= elements.length) {\n                dom.removeEventListener(document, 'focus', unveil, {\n                    capture: true,\n                    passive: true\n                });\n                dom.removeEventListener(document, 'scroll', unveil, {\n                    capture: true,\n                    passive: true\n                });\n                dom.removeEventListener(document, wheelEvent, unveil, {\n                    capture: true,\n                    passive: true\n                });\n                dom.removeEventListener(window, 'resize', unveil, {\n                    capture: true,\n                    passive: true\n                });\n            }\n        }\n\n        function unveil() {\n\n            cancelAll(cancellationTokens);\n\n            var index = cancellationTokens.length;\n            cancellationTokens.length++;\n\n            setTimeout(function () {\n                unveilInternal(index);\n            }, 1);\n        }\n\n        dom.addEventListener(document, 'focus', unveil, {\n            capture: true,\n            passive: true\n        });\n        dom.addEventListener(document, 'scroll', unveil, {\n            capture: true,\n            passive: true\n        });\n        dom.addEventListener(document, wheelEvent, unveil, {\n            capture: true,\n            passive: true\n        });\n        dom.addEventListener(window, 'resize', unveil, {\n            capture: true,\n            passive: true\n        });\n\n        unveil();\n    }\n\n    function LazyLoader(options) {\n\n        this.options = options;\n    }\n\n    LazyLoader.prototype.createObserver = function () {\n\n        unveilElementsInternal(this, this.options.callback);\n        this.observer = 1;\n    };\n\n    LazyLoader.prototype.addElements = function (elements) {\n\n        this.elements = this.elements || [];\n\n        for (var i = 0, length = elements.length; i < length; i++) {\n            this.elements.push(elements[i]);\n        }\n\n        var observer = this.observer;\n\n        if (!observer) {\n            this.createObserver();\n        }\n\n    };\n\n    LazyLoader.prototype.destroyObserver = function (elements) {\n\n    };\n\n    LazyLoader.prototype.destroy = function (elements) {\n\n        this.destroyObserver();\n        this.options = null;\n    };\n\n    function unveilElements(elements, root, callback) {\n\n        if (!elements.length) {\n            return;\n        }\n        var lazyLoader = new LazyLoader({\n            callback: callback\n        });\n        lazyLoader.addElements(elements);\n    }\n\n    LazyLoader.lazyChildren = function (elem, callback) {\n\n        unveilElements(elem.getElementsByClassName('lazy'), elem, callback);\n    };\n\n    return LazyLoader;\n});\n"]}