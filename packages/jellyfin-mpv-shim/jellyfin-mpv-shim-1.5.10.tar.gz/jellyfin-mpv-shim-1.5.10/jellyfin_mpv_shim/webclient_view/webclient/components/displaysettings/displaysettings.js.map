{"version":3,"sources":["components/displaysettings/displaysettings.js"],"names":["define","require","browser","layoutManager","appSettings","pluginManager","appHost","focusManager","datetime","globalize","loading","connectionManager","skinManager","dom","events","fillThemes","select","isDashboard","innerHTML","getThemes","map","t","value","id","isDefault","isDefaultServerDashboard","name","join","loadForm","context","user","userSettings","apiClient","getCurrentUserId","Id","Policy","IsAdministrator","querySelector","classList","remove","add","supports","supportsLocalization","tizen","web0s","checked","runAtStartup","selectTheme","selectDashboardTheme","loadScreensavers","selectScreensaver","options","ofType","plugin","unshift","translate","o","screensaver","loadSoundEffects","selectSoundEffects","soundEffects","loadSkins","selectSkin","skin","length","Configuration","DisplayMissingEpisodes","enableThemeSongs","enableThemeVideos","enableFastFadein","enableBackdrops","language","dateTimeLocale","dashboardTheme","theme","getSavedLayout","showOrHideMissingEpisodesField","hide","save","instance","userId","enableSaveConfirmation","show","getUser","then","saveUser","userSettingsInstance","setTheme","setLayout","updateUserConfiguration","toast","trigger","onSubmit","e","self","this","getApiClient","serverId","setUserInfo","element","preventDefault","DisplaySettings","embed","template","translateDocument","addEventListener","bind","enableSaveButton","loadData","autoFocus","prototype","dataLoaded","submit","call","destroy"],"mappings":"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","file":"displaysettings.js","sourcesContent":["define(['require', 'browser', 'layoutManager', 'appSettings', 'pluginManager', 'apphost', 'focusManager', 'datetime', 'globalize', 'loading', 'connectionManager', 'skinManager', 'dom', 'events', 'emby-select', 'emby-checkbox', 'emby-button'], function (require, browser, layoutManager, appSettings, pluginManager, appHost, focusManager, datetime, globalize, loading, connectionManager, skinManager, dom, events) {\n    \"use strict\";\n\n    function fillThemes(select, isDashboard) {\n        select.innerHTML = skinManager.getThemes().map(function (t) {\n            var value = t.id;\n            if (t.isDefault && !isDashboard) {\n                value = '';\n            } else if (t.isDefaultServerDashboard && isDashboard) {\n                value = '';\n            }\n\n            return '<option value=\"' + value + '\">' + t.name + '</option>';\n        }).join('');\n    }\n\n    function loadScreensavers(context, userSettings) {\n        var selectScreensaver = context.querySelector('.selectScreensaver');\n        var options = pluginManager.ofType('screensaver').map(function (plugin) {\n            return {\n                name: plugin.name,\n                value: plugin.id\n            };\n        });\n\n        options.unshift({\n            name: globalize.translate('None'),\n            value: 'none'\n        });\n\n        selectScreensaver.innerHTML = options.map(function (o) {\n            return '<option value=\"' + o.value + '\">' + o.name + '</option>';\n        }).join('');\n        selectScreensaver.value = userSettings.screensaver();\n\n        if (!selectScreensaver.value) {\n            // TODO: set the default instead of none\n            selectScreensaver.value = 'none';\n        }\n    }\n\n    function loadSoundEffects(context, userSettings) {\n\n        var selectSoundEffects = context.querySelector('.selectSoundEffects');\n        var options = pluginManager.ofType('soundeffects').map(function (plugin) {\n            return {\n                name: plugin.name,\n                value: plugin.id\n            };\n        });\n\n        options.unshift({\n            name: globalize.translate('None'),\n            value: 'none'\n        });\n\n        selectSoundEffects.innerHTML = options.map(function (o) {\n            return '<option value=\"' + o.value + '\">' + o.name + '</option>';\n        }).join('');\n        selectSoundEffects.value = userSettings.soundEffects();\n\n        if (!selectSoundEffects.value) {\n            // TODO: set the default instead of none\n            selectSoundEffects.value = 'none';\n        }\n    }\n\n    function loadSkins(context, userSettings) {\n\n        var selectSkin = context.querySelector('.selectSkin');\n\n        var options = pluginManager.ofType('skin').map(function (plugin) {\n            return {\n                name: plugin.name,\n                value: plugin.id\n            };\n        });\n\n        selectSkin.innerHTML = options.map(function (o) {\n            return '<option value=\"' + o.value + '\">' + o.name + '</option>';\n        }).join('');\n        selectSkin.value = userSettings.skin();\n\n        if (!selectSkin.value && options.length) {\n            selectSkin.value = options[0].value;\n        }\n\n        if (options.length > 1 && appHost.supports('skins')) {\n            context.querySelector('.selectSkinContainer').classList.remove('hide');\n        } else {\n            context.querySelector('.selectSkinContainer').classList.add('hide');\n        }\n    }\n\n    function showOrHideMissingEpisodesField(context, user, apiClient) {\n\n        if (browser.tizen || browser.web0s) {\n            context.querySelector('.fldDisplayMissingEpisodes').classList.add('hide');\n            return;\n        }\n\n        context.querySelector('.fldDisplayMissingEpisodes').classList.remove('hide');\n    }\n\n    function loadForm(context, user, userSettings, apiClient) {\n\n        var loggedInUserId = apiClient.getCurrentUserId();\n        var userId = user.Id;\n\n        if (user.Policy.IsAdministrator) {\n            context.querySelector('.selectDashboardThemeContainer').classList.remove('hide');\n        } else {\n            context.querySelector('.selectDashboardThemeContainer').classList.add('hide');\n        }\n\n        if (appHost.supports('displaylanguage')) {\n            context.querySelector('.languageSection').classList.remove('hide');\n        } else {\n            context.querySelector('.languageSection').classList.add('hide');\n        }\n\n        if (appHost.supports('displaymode')) {\n            context.querySelector('.fldDisplayMode').classList.remove('hide');\n        } else {\n            context.querySelector('.fldDisplayMode').classList.add('hide');\n        }\n\n        if (appHost.supports('externallinks')) {\n            context.querySelector('.learnHowToContributeContainer').classList.remove('hide');\n        } else {\n            context.querySelector('.learnHowToContributeContainer').classList.add('hide');\n        }\n\n        if (appHost.supports('runatstartup')) {\n            context.querySelector('.fldAutorun').classList.remove('hide');\n        } else {\n            context.querySelector('.fldAutorun').classList.add('hide');\n        }\n\n        if (appHost.supports('soundeffects')) {\n            context.querySelector('.fldSoundEffects').classList.remove('hide');\n        } else {\n            context.querySelector('.fldSoundEffects').classList.add('hide');\n        }\n\n        if (appHost.supports('screensaver')) {\n            context.querySelector('.selectScreensaverContainer').classList.remove('hide');\n        } else {\n            context.querySelector('.selectScreensaverContainer').classList.add('hide');\n        }\n\n        if (datetime.supportsLocalization()) {\n            context.querySelector('.fldDateTimeLocale').classList.remove('hide');\n        } else {\n            context.querySelector('.fldDateTimeLocale').classList.add('hide');\n        }\n\n        if (!browser.tizen && !browser.web0s) {\n            context.querySelector('.fldBackdrops').classList.remove('hide');\n            context.querySelector('.fldThemeSong').classList.remove('hide');\n            context.querySelector('.fldThemeVideo').classList.remove('hide');\n        } else {\n            context.querySelector('.fldBackdrops').classList.add('hide');\n            context.querySelector('.fldThemeSong').classList.add('hide');\n            context.querySelector('.fldThemeVideo').classList.add('hide');\n        }\n\n        context.querySelector('.chkRunAtStartup').checked = appSettings.runAtStartup();\n\n        var selectTheme = context.querySelector('#selectTheme');\n        var selectDashboardTheme = context.querySelector('#selectDashboardTheme');\n\n        fillThemes(selectTheme);\n        fillThemes(selectDashboardTheme, true);\n        loadScreensavers(context, userSettings);\n        loadSoundEffects(context, userSettings);\n        loadSkins(context, userSettings);\n\n        context.querySelector('.chkDisplayMissingEpisodes').checked = user.Configuration.DisplayMissingEpisodes || false;\n\n        context.querySelector('#chkThemeSong').checked = userSettings.enableThemeSongs();\n        context.querySelector('#chkThemeVideo').checked = userSettings.enableThemeVideos();\n        context.querySelector('#chkFadein').checked = userSettings.enableFastFadein();\n        context.querySelector('#chkBackdrops').checked = userSettings.enableBackdrops();\n\n        context.querySelector('#selectLanguage').value = userSettings.language() || '';\n        context.querySelector('.selectDateTimeLocale').value = userSettings.dateTimeLocale() || '';\n\n        selectDashboardTheme.value = userSettings.dashboardTheme() || '';\n        selectTheme.value = userSettings.theme() || '';\n\n        context.querySelector('.selectLayout').value = layoutManager.getSavedLayout() || '';\n\n        showOrHideMissingEpisodesField(context, user, apiClient);\n\n        loading.hide();\n    }\n\n    function saveUser(context, user, userSettingsInstance, apiClient) {\n\n        appSettings.runAtStartup(context.querySelector('.chkRunAtStartup').checked);\n\n        user.Configuration.DisplayMissingEpisodes = context.querySelector('.chkDisplayMissingEpisodes').checked;\n\n        if (appHost.supports('displaylanguage')) {\n            userSettingsInstance.language(context.querySelector('#selectLanguage').value);\n        }\n\n        userSettingsInstance.dateTimeLocale(context.querySelector('.selectDateTimeLocale').value);\n\n        userSettingsInstance.enableThemeSongs(context.querySelector('#chkThemeSong').checked);\n        userSettingsInstance.enableThemeVideos(context.querySelector('#chkThemeVideo').checked);\n        userSettingsInstance.dashboardTheme(context.querySelector('#selectDashboardTheme').value);\n        userSettingsInstance.theme(context.querySelector('#selectTheme').value);\n        userSettingsInstance.soundEffects(context.querySelector('.selectSoundEffects').value);\n        userSettingsInstance.screensaver(context.querySelector('.selectScreensaver').value);\n\n        userSettingsInstance.skin(context.querySelector('.selectSkin').value);\n\n        userSettingsInstance.enableFastFadein(context.querySelector('#chkFadein').checked);\n        userSettingsInstance.enableBackdrops(context.querySelector('#chkBackdrops').checked);\n\n        if (user.Id === apiClient.getCurrentUserId()) {\n            skinManager.setTheme(userSettingsInstance.theme());\n        }\n\n        layoutManager.setLayout(context.querySelector('.selectLayout').value);\n        return apiClient.updateUserConfiguration(user.Id, user.Configuration);\n    }\n\n    function save(instance, context, userId, userSettings, apiClient, enableSaveConfirmation) {\n        loading.show();\n\n        apiClient.getUser(userId).then(function (user) {\n            saveUser(context, user, userSettings, apiClient).then(function () {\n                loading.hide();\n                if (enableSaveConfirmation) {\n                    require(['toast'], function (toast) {\n                        toast(globalize.translate('SettingsSaved'));\n                    });\n                }\n                events.trigger(instance, 'saved');\n            }, function () {\n                loading.hide();\n            });\n        });\n    }\n\n    function onSubmit(e) {\n        var self = this;\n        var apiClient = connectionManager.getApiClient(self.options.serverId);\n        var userId = self.options.userId;\n        var userSettings = self.options.userSettings;\n\n        userSettings.setUserInfo(userId, apiClient).then(function () {\n            var enableSaveConfirmation = self.options.enableSaveConfirmation;\n            save(self, self.options.element, userId, userSettings, apiClient, enableSaveConfirmation);\n        });\n\n        // Disable default form submission\n        if (e) {\n            e.preventDefault();\n        }\n        return false;\n    }\n\n    function embed(options, self) {\n        require(['text!./displaysettings.template.html'], function (template) {\n            options.element.innerHTML = globalize.translateDocument(template, 'core');\n            options.element.querySelector('form').addEventListener('submit', onSubmit.bind(self));\n            if (options.enableSaveButton) {\n                options.element.querySelector('.btnSave').classList.remove('hide');\n            }\n            self.loadData(options.autoFocus);\n        });\n    }\n\n    function DisplaySettings(options) {\n        this.options = options;\n        embed(options, this);\n    }\n\n    DisplaySettings.prototype.loadData = function (autoFocus) {\n        var self = this;\n        var context = self.options.element;\n\n        loading.show();\n\n        var userId = self.options.userId;\n        var apiClient = connectionManager.getApiClient(self.options.serverId);\n        var userSettings = self.options.userSettings;\n\n        return apiClient.getUser(userId).then(function (user) {\n            return userSettings.setUserInfo(userId, apiClient).then(function () {\n                self.dataLoaded = true;\n                loadForm(context, user, userSettings, apiClient);\n                if (autoFocus) {\n                    focusManager.autoFocus(context);\n                }\n            });\n        });\n    };\n\n    DisplaySettings.prototype.submit = function () {\n        onSubmit.call(this);\n    };\n\n    DisplaySettings.prototype.destroy = function () {\n        this.options = null;\n    };\n\n    return DisplaySettings;\n});\n"]}