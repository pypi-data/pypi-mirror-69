{"version":3,"sources":["components/cardbuilder/chaptercardbuilder.js"],"names":["define","datetime","imageLoader","connectionManager","layoutManager","browser","enableFocusTransform","slow","edge","buildChapterCard","item","apiClient","chapter","index","options","className","shape","imgUrl","getImgUrl","maxWidth","ImageTag","getScaledImageUrl","Id","tag","type","width","cardImageContainerClass","coverImage","dataAttributes","IsFolder","ServerId","Type","MediaType","StartPositionTicks","cardImageContainer","nameHtml","Name","getDisplayRunningTime","buildChapterCards","chapters","parentContainer","document","body","contains","length","classList","add","remove","html","buildChapterCardsHtml","tv","videoStream","MediaSources","MediaStreams","filter","i","backdropShape","Width","Height","squareShape","block","rows","itemsInRow","getApiClient","itemsContainer","innerHTML","lazyChildren"],"mappings":"AAAA,aAAAA,OAAO,CAAC,WAAY,cAAe,oBAAqB,gBAAiB,YAAY,SAAUC,SAAUC,YAAaC,kBAAmBC,cAAeC,SAGpJ,IAAIC,sBAAwBD,QAAQE,OAASF,QAAQG,KA6ErD,SAASC,iBAAiBC,KAAMC,UAAWC,QAASC,MAAOC,QAASC,UAAWC,OAE3E,IAAIC,OAlBR,SAASC,UAAUR,KAAME,QAASC,MAAOM,SAAUR,WAE/C,OAAIC,QAAQQ,SAEDT,UAAUU,kBAAkBX,KAAKY,GAAI,CAExCH,SAAqB,EAAXA,SACVI,IAAKX,QAAQQ,SACbI,KAAM,UACNX,MAAOA,QAIR,KAKMK,CAAUR,KAAME,QAASC,MAAOC,QAAQW,OAAS,IAAKd,WAE/De,wBAA0B,8EAC1BZ,QAAQa,aACRD,yBAA2B,iBAE/B,IAAIE,eAAiB,sCAAwClB,KAAKmB,SAAW,cAAgBnB,KAAKY,GAAK,oBAAsBZ,KAAKoB,SAAW,gBAAkBpB,KAAKqB,KAAO,qBAAuBrB,KAAKsB,UAAY,yBAA2BpB,QAAQqB,mBAAqB,IACvQC,mBAAqBjB,OAAU,eAAiBS,wBAA0B,oBAAsBT,OAAS,KAAS,eAAiBS,wBAA0B,KAE5JT,SACDiB,oBAAsB,6DAG1B,IAAIC,SAAW,GACfA,UAAY,yBAA2BvB,QAAQwB,KAAO,SAQtD,MAFW,gCAAkCrB,UAAY,IAAMa,eAAiB,0EAAyGZ,MAAQ,WAAakB,mBAAqB,uCALnOC,UAAY,yBAA2BlC,SAASoC,sBAAsBzB,QAAQqB,oBAAsB,UAKkL,8BA4B1R,MAAO,CACHK,kBAxBJ,SAASA,kBAAkB5B,KAAM6B,SAAUzB,SAEvC,GAAIA,QAAQ0B,gBAAiB,CAEzB,IAAKC,SAASC,KAAKC,SAAS7B,QAAQ0B,iBAChC,OAGJ,IAAID,SAASK,OAIT,YADA9B,QAAQ0B,gBAAgBK,UAAUC,IAAI,QAFtChC,QAAQ0B,gBAAgBK,UAAUE,OAAO,QAOjD,IAAIC,KAtHR,SAASC,sBAAsBvC,KAAM6B,SAAUzB,SAI3C,IAAIC,UAAY,8BAEZX,cAAc8C,KACdnC,WAAa,cAETT,uBACAS,WAAa,oBAIrB,IACIoC,eADiBzC,KAAK0C,cAAgB,IAAI,IAAM,IAAIC,cAAgB,IACzCC,QAAO,SAAUC,GAC5C,MAAkB,UAAXA,EAAExB,QACV,IAAM,GAELf,MAASF,QAAQ0C,eAAiB,WAElCL,YAAYM,OAASN,YAAYO,QAE5BP,YAAYM,MAAQN,YAAYO,QAAW,MAC5C1C,MAASF,QAAQ6C,aAAe,UAIxC5C,WAAa,IAAMC,MAAQ,QAEvBF,QAAQ8C,OAAS9C,QAAQ+C,QACzB9C,WAAa,UAQjB,IALA,IAAIiC,KAAO,GACPc,WAAa,EAEbnD,UAAYR,kBAAkB4D,aAAarD,KAAKoB,UAE3CyB,EAAI,EAAGX,OAASL,SAASK,OAAQW,EAAIX,OAAQW,IAAK,CAEnDzC,QAAQ+C,MAAuB,IAAfC,aAChBd,MAAQ,4BAKZA,MAAQvC,iBAAiBC,KAAMC,UAFjB4B,SAASgB,GAE4BA,EAAGzC,QAASC,UAAWC,OAC1E8C,aAEIhD,QAAQ+C,MAAQC,YAAchD,QAAQ+C,OACtCC,WAAa,EACbd,MAAQ,UAIhB,OAAOA,KA8DIC,CAAsBvC,KAAM6B,SAAUzB,SAEjDA,QAAQkD,eAAeC,UAAYjB,KAEnC9C,YAAYgE,aAAapD,QAAQkD","file":"chaptercardbuilder.js","sourcesContent":["define(['datetime', 'imageLoader', 'connectionManager', 'layoutManager', 'browser'], function (datetime, imageLoader, connectionManager, layoutManager, browser) {\n    'use strict';\n\n    var enableFocusTransform = !browser.slow && !browser.edge;\n\n    function buildChapterCardsHtml(item, chapters, options) {\n\n        // TODO move card creation code to Card component\n\n        var className = 'card itemAction chapterCard';\n\n        if (layoutManager.tv) {\n            className += ' show-focus';\n\n            if (enableFocusTransform) {\n                className += ' show-animation';\n            }\n        }\n\n        var mediaStreams = ((item.MediaSources || [])[0] || {}).MediaStreams || [];\n        var videoStream = mediaStreams.filter(function (i) {\n            return i.Type === 'Video';\n        })[0] || {};\n\n        var shape = (options.backdropShape || 'backdrop');\n\n        if (videoStream.Width && videoStream.Height) {\n\n            if ((videoStream.Width / videoStream.Height) <= 1.2) {\n                shape = (options.squareShape || 'square');\n            }\n        }\n\n        className += ' ' + shape + 'Card';\n\n        if (options.block || options.rows) {\n            className += ' block';\n        }\n\n        var html = '';\n        var itemsInRow = 0;\n\n        var apiClient = connectionManager.getApiClient(item.ServerId);\n\n        for (var i = 0, length = chapters.length; i < length; i++) {\n\n            if (options.rows && itemsInRow === 0) {\n                html += '<div class=\"cardColumn\">';\n            }\n\n            var chapter = chapters[i];\n\n            html += buildChapterCard(item, apiClient, chapter, i, options, className, shape);\n            itemsInRow++;\n\n            if (options.rows && itemsInRow >= options.rows) {\n                itemsInRow = 0;\n                html += '</div>';\n            }\n        }\n\n        return html;\n    }\n\n    function getImgUrl(item, chapter, index, maxWidth, apiClient) {\n\n        if (chapter.ImageTag) {\n\n            return apiClient.getScaledImageUrl(item.Id, {\n\n                maxWidth: maxWidth * 2,\n                tag: chapter.ImageTag,\n                type: \"Chapter\",\n                index: index\n            });\n        }\n\n        return null;\n    }\n\n    function buildChapterCard(item, apiClient, chapter, index, options, className, shape) {\n\n        var imgUrl = getImgUrl(item, chapter, index, options.width || 400, apiClient);\n\n        var cardImageContainerClass = 'cardContent cardContent-shadow cardImageContainer chapterCardImageContainer';\n        if (options.coverImage) {\n            cardImageContainerClass += ' coveredImage';\n        }\n        var dataAttributes = ' data-action=\"play\" data-isfolder=\"' + item.IsFolder + '\" data-id=\"' + item.Id + '\" data-serverid=\"' + item.ServerId + '\" data-type=\"' + item.Type + '\" data-mediatype=\"' + item.MediaType + '\" data-positionticks=\"' + chapter.StartPositionTicks + '\"';\n        var cardImageContainer = imgUrl ? ('<div class=\"' + cardImageContainerClass + ' lazy\" data-src=\"' + imgUrl + '\">') : ('<div class=\"' + cardImageContainerClass + '\">');\n\n        if (!imgUrl) {\n            cardImageContainer += '<i class=\"material-icons cardImageIcon local_movies\"></i>';\n        }\n\n        var nameHtml = '';\n        nameHtml += '<div class=\"cardText\">' + chapter.Name + '</div>';\n        nameHtml += '<div class=\"cardText\">' + datetime.getDisplayRunningTime(chapter.StartPositionTicks) + '</div>';\n\n        var cardBoxCssClass = 'cardBox';\n        var cardScalableClass = 'cardScalable';\n\n        var html = '<button type=\"button\" class=\"' + className + '\"' + dataAttributes + '><div class=\"' + cardBoxCssClass + '\"><div class=\"' + cardScalableClass + '\"><div class=\"cardPadder-' + shape + '\"></div>' + cardImageContainer + '</div><div class=\"innerCardFooter\">' + nameHtml + '</div></div></div></button>';\n\n        return html;\n    }\n\n    function buildChapterCards(item, chapters, options) {\n\n        if (options.parentContainer) {\n            // Abort if the container has been disposed\n            if (!document.body.contains(options.parentContainer)) {\n                return;\n            }\n\n            if (chapters.length) {\n                options.parentContainer.classList.remove('hide');\n            } else {\n                options.parentContainer.classList.add('hide');\n                return;\n            }\n        }\n\n        var html = buildChapterCardsHtml(item, chapters, options);\n\n        options.itemsContainer.innerHTML = html;\n\n        imageLoader.lazyChildren(options.itemsContainer);\n    }\n\n    return {\n        buildChapterCards: buildChapterCards\n    };\n\n});\n"]}