{"version":3,"sources":["components/apphost.js"],"names":["define","appSettings","browser","events","htmlMediaHelper","getBaseProfileOptions","item","disableHlsVideoAudioCodecs","enableHlsJsPlayer","RunTimeTicks","MediaType","edge","msie","push","enableMkvProgressive","generateDeviceId","keys","navigator","userAgent","Date","getTime","self","btoa","result","replaceAll","originalString","strReplace","strWith","strReplace2","escapeRegExp","str","replace","reg","RegExp","join","Promise","resolve","onAppVisible","isHidden","console","debug","trigger","appHost","onAppHidden","features","exitPromise","deviceId","deviceName","supportedFeatures","share","edgeUwp","tv","xboxOne","ps4","operaTv","tizen","orsay","web0s","supportsVoiceInput","window","SpeechRecognition","webkitSpeechRecognition","mozSpeechRecognition","oSpeechRecognition","msSpeechRecognition","supportsHtmlMediaAutoplay","mobile","supportsFullscreen","element","document","documentElement","requestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","msRequestFullscreen","createElement","webkitEnterFullscreen","chrome","slow","noAnimation","firefox","supportsCue","video","style","textContent","body","appendChild","cue","getComputedStyle","background","removeChild","length","err","error","doExit","NativeShell","AppHost","exit","application","getCurrentApplication","webOS","platformBack","close","visibilityChange","visibilityState","getWindowState","windowState","setWindowState","state","alert","appMode","askForExit","require","actionsheet","show","title","Globalize","translate","items","id","name","then","value","finally","supports","command","indexOf","toLowerCase","preferVisualCards","android","moreIcon","getSyncProfile","profileBuilder","profile","MaxStaticMusicBitrate","maxStaticMusicBitrate","getDefaultLayout","getDeviceProfile","options","Windows","getDeviceProfileForWindowsUwp","reject","uwpMediaCaps","profileOptions","supportsDts","supportsDTS","supportsTrueHd","supportsDolby","audioChannels","getAudioChannels","isRetry","get","SubtitleProfiles","Format","Method","init","getDeviceName","opera","safari","ipad","iphone","getDeviceId","key","set","appName","appVersion","getPushTokenInfo","setThemeColor","color","metaThemeColor","querySelector","setAttribute","setUserScalable","scalable","att","doc","mozHidden","msHidden","webkitHidden","addEventListener"],"mappings":"AAAA,aAAAA,OAAO,CAAC,cAAe,UAAW,SAAU,oBAAoB,SAAUC,YAAaC,QAASC,OAAQC,iBAGpG,SAASC,sBAAsBC,MAC3B,IAAIC,2BAA6B,GAYjC,OAVID,MAAQF,gBAAgBI,kBAAkBF,KAAKG,aAAcH,KAAKI,cAC9DR,QAAQS,MAAQT,QAAQU,OACxBL,2BAA2BM,KAAK,OAGpCN,2BAA2BM,KAAK,OAChCN,2BAA2BM,KAAK,QAChCN,2BAA2BM,KAAK,SAG7B,CACHC,sBAAsB,EACtBP,2BAA4BA,4BA6DpC,SAASQ,mBACL,IAAIC,KAAO,GAEX,GAAIA,KAAKH,KAAKI,UAAUC,WAAYF,KAAKH,MAAK,IAAIM,MAAOC,WAAYC,KAAKC,KAAM,CAC5E,IAAIC,OAVZ,SAASC,WAAWC,eAAgBC,WAAYC,SAC5C,IAAIC,YALR,SAASC,aAAaC,KAClB,OAAOA,IAAIC,QAAQ,8BAA+B,QAIhCF,CAAaH,YAC3BM,IAAM,IAAIC,OAAOL,YAAa,MAClC,OAAOH,eAAeM,QAAQC,IAAKL,SAOlBH,CAAWF,KAAKN,KAAKkB,KAAK,MAAO,IAAK,KACnD,OAAOC,QAAQC,QAAQb,QAG3B,OAAOY,QAAQC,SAAQ,IAAIjB,MAAOC,WA0GtC,SAASiB,eACDC,WACAA,UAAW,EACXC,QAAQC,MAAM,+BACdrC,OAAOsC,QAAQC,QAAS,WAIhC,SAASC,cACAL,WACDA,UAAW,EACXC,QAAQC,MAAM,kBAItB,IACQI,SA+GJC,YA2BAC,UACAC,YA5IAC,mBACIJ,SAAW,GAEX3B,UAAUgC,OACVL,SAAS/B,KAAK,WAGbX,QAAQgD,SAAYhD,QAAQiD,IAAOjD,QAAQkD,SAAYlD,QAAQmD,KAChET,SAAS/B,KAAK,gBAGdX,QAAQoD,SAAWpD,QAAQqD,OAASrD,QAAQsD,OAAStD,QAAQuD,MAC7Db,SAAS/B,KAAK,SAEd+B,SAAS/B,KAAK,YACd+B,SAAS/B,KAAK,YAGbX,QAAQoD,SAAYpD,QAAQqD,OAAUrD,QAAQsD,OAAUtD,QAAQuD,OAAUvD,QAAQmD,MACnFT,SAAS/B,KAAK,iBACd+B,SAAS/B,KAAK,oBAGbX,QAAQoD,SACTV,SAAS/B,KAAK,uBA7GtB,SAAS6C,qBACL,OAAKxD,QAAQiD,KACFQ,OAAOC,mBAAqBD,OAAOE,yBAA2BF,OAAOG,sBAAwBH,OAAOI,oBAAsBJ,OAAOK,qBA8GxIN,IACAd,SAAS/B,KAAK,cAGbX,QAAQiD,IAAOjD,QAAQkD,SACxBlD,QAAQmD,IA/EhB,SAASY,4BACL,SAAI/D,QAAQgD,SAAWhD,QAAQqD,OAASrD,QAAQuD,OAASvD,QAAQsD,OAAStD,QAAQoD,SAAWpD,QAAQmD,KAAOnD,QAAQkD,WAIhHlD,QAAQgE,OA6ERD,KACArB,SAAS/B,KAAK,qBACd+B,SAAS/B,KAAK,sBAGdX,QAAQgD,SACRN,SAAS/B,KAAK,QAtHtB,SAASsD,qBACL,GAAIjE,QAAQiD,GACR,OAAO,EAGX,IAAIiB,QAAUC,SAASC,gBACvB,OAAQF,QAAQG,mBAAqBH,QAAQI,sBAAwBJ,QAAQK,yBAA2BL,QAAQM,qBAAwBL,SAASM,cAAc,SAASC,sBAmHpKT,IACAvB,SAAS/B,KAAK,qBAGdX,QAAQ2E,QAAU3E,QAAQS,OAAST,QAAQ4E,QACtC5E,QAAQ6E,aAAgB7E,QAAQgD,SAAYhD,QAAQkD,SACrDR,SAAS/B,KAAK,mBAIlBX,QAAQiD,IAAMjD,QAAQkD,SAAWlD,QAAQmD,KAAOnD,QAAQgE,SACxDtB,SAAS/B,KAAK,yBAGbX,QAAQiD,IAAOjD,QAAQkD,SAAYlD,QAAQmD,KAC5CT,SAAS/B,KAAK,iBAGbX,QAAQoD,SAAYpD,QAAQqD,OAAUrD,QAAQsD,OAAUtD,QAAQuD,OAAUvD,QAAQgD,SACnFN,SAAS/B,KAAK,eAGlB+B,SAAS/B,KAAK,mBACd+B,SAAS/B,KAAK,sBACd+B,SAAS/B,KAAK,eACd+B,SAAS/B,KAAK,eAGd+B,SAAS/B,KAAK,eAETX,QAAQsD,OAAUtD,QAAQU,QAASV,QAAQ8E,SAAW9E,QAAQmD,KAAOnD,QAAQS,MA7GtF,SAASsE,cACL,IACI,IAAIC,MAAQb,SAASM,cAAc,SAC/BQ,MAAQd,SAASM,cAAc,SAEnCQ,MAAMC,YAAc,mCACpBf,SAASgB,KAAKC,YAAYH,OAC1Bd,SAASgB,KAAKC,YAAYJ,OAE1B,IAAIK,IAAM5B,OAAO6B,iBAAiBN,MAAO,SAASO,WAIlD,OAHApB,SAASgB,KAAKK,YAAYP,OAC1Bd,SAASgB,KAAKK,YAAYR,SAEjBK,IAAII,OACf,MAAOC,KAEL,OADArD,QAAQsD,MAAM,gCAAkCD,MACzC,GA6F+EX,KACtFrC,SAAS/B,KAAK,8BAGbX,QAAQsD,OACTZ,SAAS/B,KAAK,wBAGbX,QAAQiD,IAAOjD,QAAQmD,KAAQnD,QAAQkD,SACxCR,SAAS/B,KAAK,aAGdX,QAAQ2E,QACRjC,SAAS/B,KAAK,cAGX+B,UAMX,SAASkD,SACL,IACQnC,OAAOoC,YACPpC,OAAOoC,YAAYC,QAAQC,OACpB/F,QAAQqD,MACfA,MAAM2C,YAAYC,wBAAwBF,OACnC/F,QAAQuD,MACf2C,MAAMC,eAEN1C,OAAO2C,QAEb,MAAOV,KACLrD,QAAQsD,MAAM,8BAAgCD,MAiCtD,IAEIW,iBACAC,gBAEA9D,QAAU,CACV+D,eAAgB,SAAAA,iBACZ,OAAOpC,SAASqC,aAAe,UAEnCC,eAAgB,SAAAA,eAAUC,OACtBC,MAAM,6DAEVZ,KAAM,SAAAA,OACItC,OAAOmD,SAAW5G,QAAQqD,MArCxC,SAASwD,aACDlE,aAIJmE,QAAQ,CAAC,gBAAgB,SAAUC,aAC/BpE,YAAcoE,YAAYC,KAAK,CAC3BC,MAAOC,UAAUC,UAAU,yBAC3BC,MAAO,CACH,CAACC,GAAI,MAAOC,KAAMJ,UAAUC,UAAU,QACtC,CAACE,GAAI,KAAMC,KAAMJ,UAAUC,UAAU,UAE1CI,MAAK,SAAUC,OACA,QAAVA,OACA5B,YAEL6B,SAAQ,WACP9E,YAAc,WAqBdkE,GAEAjB,UAGR8B,SAAU,SAAAA,SAAUC,SAChB,OAAIlE,OAAOoC,YACApC,OAAOoC,YAAYC,QAAQ4B,SAASC,UAGvC,IAAM7E,kBAAkB8E,QAAQD,QAAQE,gBAEpDC,kBAAmB9H,QAAQ+H,SAAW/H,QAAQ2E,OAC9CqD,SAAUhI,QAAQ+H,QAAU,YAAc,aAC1CE,eA7OJ,SAASA,iBACL,OAAO,IAAIhG,SAAQ,SAAUC,SACzB4E,QAAQ,CAAC,uBAAwB,gBAAgB,SAAUoB,eAAgBnI,aACvE,IAAIoI,QAEA1E,OAAOoC,YACPsC,QAAU1E,OAAOoC,YAAYC,QAAQmC,eAAeC,eAAgBnI,cAEpEoI,QAAUD,kBACFE,sBAAwBrI,YAAYsI,wBAGhDnG,QAAQiG,gBAkOhBG,iBAAkB,SAAAA,mBACd,OAAI7E,OAAOoC,YACApC,OAAOoC,YAAYC,QAAQwC,mBA9NnC,WAmOPC,iBA/VJ,SAASA,iBAAiBnI,KAAMoI,SAG5B,OAFAA,QAAUA,SAAW,GAEjBrH,KAAKsH,QAfb,SAASC,8BAA8BtI,MACnC,OAAO,IAAI6B,SAAQ,SAAUC,QAASyG,QAClC7B,QAAQ,CAAC,uBAAwB,uCAAuC,SAAUoB,eAAgBU,cAC9F,IAAIC,eAAiB1I,sBAAsBC,MAC3CyI,eAAeC,YAAcF,aAAaG,cAC1CF,eAAeG,eAAiBJ,aAAaK,gBAC7CJ,eAAeK,cAAgBN,aAAaO,mBAC5CjH,QAAQgG,eAAeW,uBASpBH,CAA8BtI,MAGlC,IAAI6B,SAAQ,SAAUC,SACzB4E,QAAQ,CAAC,yBAAyB,SAAUoB,gBACxC,IAAIC,QAEA1E,OAAOoC,YACPsC,QAAU1E,OAAOoC,YAAYC,QAAQyC,iBAAiBL,iBAEtDC,QAAUD,eAAe/H,sBAAsBC,OAE3CA,OAASoI,QAAQY,SAAW,sBAAwBrJ,YAAYsJ,IAAI,oBAC/DrJ,QAAQsD,OAAUtD,QAAQqD,QAC3B8E,QAAQmB,iBAAiB3I,KAAK,CAC1B4I,OAAQ,MACRC,OAAQ,aAEZrB,QAAQmB,iBAAiB3I,KAAK,CAC1B4I,OAAQ,MACRC,OAAQ,gBAMxBtH,QAAQiG,gBAkUhBsB,KAAM,SAAAA,OACF,GAAIhG,OAAOoC,YACP,OAAOpC,OAAOoC,YAAYC,QAAQ2D,OAGtC5G,YA/RR,SAAS6G,gBACL,IAAI7G,WAeJ,OAdAA,WAAa7C,QAAQqD,MAAQ,mBAAqBrD,QAAQuD,MAAQ,cAAgBvD,QAAQoD,QAAU,WAAapD,QAAQkD,QAAU,WAAalD,QAAQmD,IAAM,WAAanD,QAAQ2E,OAAS,SAAW3E,QAAQS,KAAO,OAAST,QAAQ8E,QAAU,UAAY9E,QAAQU,KAAO,oBAAsBV,QAAQ2J,MAAQ,QAAU3J,QAAQ4J,OAAS,SAAW,cAEpV5J,QAAQ6J,KACRhH,YAAc,QAEV7C,QAAQ8J,OACRjH,YAAc,UAEV7C,QAAQ+H,UACRlF,YAAc,YAKnBA,WA+QU6G,GA7SrB,SAASK,cACL,IAAIC,IAAM,aACNpH,SAAW7C,YAAYsJ,IAAIW,KAE/B,OAAIpH,SACOX,QAAQC,QAAQU,UAGpB/B,mBAAmB0G,MAAK,SAAU3E,UAErC,OADA7C,YAAYkK,IAAID,IAAKpH,UACdA,YAoSPmH,GAAcxC,MAAK,SAAUF,IACzBzE,UAAWyE,OAGnBxE,WAAY,SAAAA,aACR,OAAOY,OAAOoC,YAAcpC,OAAOoC,YAAYC,QAAQjD,aAAeA,aAE1ED,SAAU,SAAAA,WACN,OAAOa,OAAOoC,YAAcpC,OAAOoC,YAAYC,QAAQlD,WAAaA,WAExEsH,QAAS,SAAAA,UACL,OAAOzG,OAAOoC,YAAcpC,OAAOoC,YAAYC,QAAQoE,UAtDjD,gBAwDVC,WAAY,SAAAA,aACR,OAAO1G,OAAOoC,YAAcpC,OAAOoC,YAAYC,QAAQqE,aAxD9C,UA0DbC,iBAAkB,SAAAA,mBACd,MAAO,IAEXC,cAAe,SAAAA,cAAUC,OACrB,IAAIC,eAAiBpG,SAASqG,cAAc,0BAExCD,gBACAA,eAAeE,aAAa,UAAWH,QAG/CI,gBAAiB,SAAAA,gBAAUC,UACvB,IAAK3K,QAAQiD,GAAI,CACb,IAAI2H,IAAMD,SAAW,0EAA4E,0FACjGxG,SAASqG,cAAc,uBAAuBC,aAAa,UAAWG,QAK9EC,IAAM1J,KAAKgD,SACX/B,UAAW,EAuCf,OArCIyI,WACI,IAAWA,IAAIvE,iBACfD,iBAAmB,mBACnBC,gBAAkB,eAEd,IAAWuE,IAAIC,WACfzE,iBAAmB,sBACnBC,gBAAkB,2BAEd,IAAWuE,IAAIE,UACf1E,iBAAmB,qBACnBC,gBAAkB,0BAEd,IAAWuE,IAAIG,eACf3E,iBAAmB,yBACnBC,gBAAkB,0BAOlCuE,KACAA,IAAII,iBAAiB5E,kBAAkB,WAC/BlC,SAASmC,iBACT7D,cAEAN,kBAKRhB,KAAK8J,mBACL9J,KAAK8J,iBAAiB,QAAS9I,cAC/BhB,KAAK8J,iBAAiB,OAAQxI,cAG3BD","file":"apphost.js","sourcesContent":["define([\"appSettings\", \"browser\", \"events\", \"htmlMediaHelper\"], function (appSettings, browser, events, htmlMediaHelper) {\n    \"use strict\";\n\n    function getBaseProfileOptions(item) {\n        var disableHlsVideoAudioCodecs = [];\n\n        if (item && htmlMediaHelper.enableHlsJsPlayer(item.RunTimeTicks, item.MediaType)) {\n            if (browser.edge || browser.msie) {\n                disableHlsVideoAudioCodecs.push(\"mp3\");\n            }\n\n            disableHlsVideoAudioCodecs.push(\"ac3\");\n            disableHlsVideoAudioCodecs.push(\"eac3\");\n            disableHlsVideoAudioCodecs.push(\"opus\");\n        }\n\n        return {\n            enableMkvProgressive: false,\n            disableHlsVideoAudioCodecs: disableHlsVideoAudioCodecs\n        };\n    }\n\n    function getDeviceProfileForWindowsUwp(item) {\n        return new Promise(function (resolve, reject) {\n            require([\"browserdeviceprofile\", \"environments/windows-uwp/mediacaps\"], function (profileBuilder, uwpMediaCaps) {\n                var profileOptions = getBaseProfileOptions(item);\n                profileOptions.supportsDts = uwpMediaCaps.supportsDTS();\n                profileOptions.supportsTrueHd = uwpMediaCaps.supportsDolby();\n                profileOptions.audioChannels = uwpMediaCaps.getAudioChannels();\n                resolve(profileBuilder(profileOptions));\n            });\n        });\n    }\n\n    function getDeviceProfile(item, options) {\n        options = options || {};\n\n        if (self.Windows) {\n            return getDeviceProfileForWindowsUwp(item);\n        }\n\n        return new Promise(function (resolve) {\n            require([\"browserdeviceprofile\"], function (profileBuilder) {\n                var profile;\n\n                if (window.NativeShell) {\n                    profile = window.NativeShell.AppHost.getDeviceProfile(profileBuilder);\n                } else {\n                    profile = profileBuilder(getBaseProfileOptions(item));\n\n                    if (item && !options.isRetry && \"allcomplexformats\" !== appSettings.get(\"subtitleburnin\")) {\n                        if (!browser.orsay && !browser.tizen) {\n                            profile.SubtitleProfiles.push({\n                                Format: \"ass\",\n                                Method: \"External\"\n                            });\n                            profile.SubtitleProfiles.push({\n                                Format: \"ssa\",\n                                Method: \"External\"\n                            });\n                        }\n                    }\n                }\n\n                resolve(profile);\n            });\n        });\n    }\n\n    function escapeRegExp(str) {\n        return str.replace(/([.*+?^=!:${}()|\\[\\]\\/\\\\])/g, \"\\\\$1\");\n    }\n\n    function replaceAll(originalString, strReplace, strWith) {\n        var strReplace2 = escapeRegExp(strReplace);\n        var reg = new RegExp(strReplace2, \"ig\");\n        return originalString.replace(reg, strWith);\n    }\n\n    function generateDeviceId() {\n        var keys = [];\n\n        if (keys.push(navigator.userAgent), keys.push(new Date().getTime()), self.btoa) {\n            var result = replaceAll(btoa(keys.join(\"|\")), \"=\", \"1\");\n            return Promise.resolve(result);\n        }\n\n        return Promise.resolve(new Date().getTime());\n    }\n\n    function getDeviceId() {\n        var key = \"_deviceId2\";\n        var deviceId = appSettings.get(key);\n\n        if (deviceId) {\n            return Promise.resolve(deviceId);\n        }\n\n        return generateDeviceId().then(function (deviceId) {\n            appSettings.set(key, deviceId);\n            return deviceId;\n        });\n    }\n\n    function getDeviceName() {\n        var deviceName;\n        deviceName = browser.tizen ? \"Samsung Smart TV\" : browser.web0s ? \"LG Smart TV\" : browser.operaTv ? \"Opera TV\" : browser.xboxOne ? \"Xbox One\" : browser.ps4 ? \"Sony PS4\" : browser.chrome ? \"Chrome\" : browser.edge ? \"Edge\" : browser.firefox ? \"Firefox\" : browser.msie ? \"Internet Explorer\" : browser.opera ? \"Opera\" : browser.safari ? \"Safari\" : \"Web Browser\";\n\n        if (browser.ipad) {\n            deviceName += \" iPad\";\n        } else {\n            if (browser.iphone) {\n                deviceName += \" iPhone\";\n            } else {\n                if (browser.android) {\n                    deviceName += \" Android\";\n                }\n            }\n        }\n\n        return deviceName;\n    }\n\n    function supportsVoiceInput() {\n        if (!browser.tv) {\n            return window.SpeechRecognition || window.webkitSpeechRecognition || window.mozSpeechRecognition || window.oSpeechRecognition || window.msSpeechRecognition;\n        }\n\n        return false;\n    }\n\n    function supportsFullscreen() {\n        if (browser.tv) {\n            return false;\n        }\n\n        var element = document.documentElement;\n        return (element.requestFullscreen || element.mozRequestFullScreen || element.webkitRequestFullscreen || element.msRequestFullscreen) || document.createElement(\"video\").webkitEnterFullscreen;\n    }\n\n    function getSyncProfile() {\n        return new Promise(function (resolve) {\n            require([\"browserdeviceprofile\", \"appSettings\"], function (profileBuilder, appSettings) {\n                var profile;\n\n                if (window.NativeShell) {\n                    profile = window.NativeShell.AppHost.getSyncProfile(profileBuilder, appSettings);\n                } else {\n                    profile = profileBuilder();\n                    profile.MaxStaticMusicBitrate = appSettings.maxStaticMusicBitrate();\n                }\n\n                resolve(profile);\n            });\n        });\n    }\n\n    function getDefaultLayout() {\n        return \"desktop\";\n    }\n\n    function supportsHtmlMediaAutoplay() {\n        if (browser.edgeUwp || browser.tizen || browser.web0s || browser.orsay || browser.operaTv || browser.ps4 || browser.xboxOne) {\n            return true;\n        }\n\n        if (browser.mobile) {\n            return false;\n        }\n\n        return true;\n    }\n\n    function supportsCue() {\n        try {\n            var video = document.createElement(\"video\");\n            var style = document.createElement(\"style\");\n\n            style.textContent = \"video::cue {background: inherit}\";\n            document.body.appendChild(style);\n            document.body.appendChild(video);\n\n            var cue = window.getComputedStyle(video, \"::cue\").background;\n            document.body.removeChild(style);\n            document.body.removeChild(video);\n\n            return !!cue.length;\n        } catch (err) {\n            console.error(\"error detecting cue support: \" + err);\n            return false;\n        }\n    }\n\n    function onAppVisible() {\n        if (isHidden) {\n            isHidden = false;\n            console.debug(\"triggering app resume event\");\n            events.trigger(appHost, \"resume\");\n        }\n    }\n\n    function onAppHidden() {\n        if (!isHidden) {\n            isHidden = true;\n            console.debug(\"app is hidden\");\n        }\n    }\n\n    var supportedFeatures = function () {\n        var features = [];\n\n        if (navigator.share) {\n            features.push(\"sharing\");\n        }\n\n        if (!browser.edgeUwp && !browser.tv && !browser.xboxOne && !browser.ps4) {\n            features.push(\"filedownload\");\n        }\n\n        if (browser.operaTv || browser.tizen || browser.orsay || browser.web0s) {\n            features.push(\"exit\");\n        } else {\n            features.push(\"exitmenu\");\n            features.push(\"plugins\");\n        }\n\n        if (!browser.operaTv && !browser.tizen && !browser.orsay && !browser.web0s && !browser.ps4) {\n            features.push(\"externallinks\");\n            features.push(\"externalpremium\");\n        }\n\n        if (!browser.operaTv) {\n            features.push(\"externallinkdisplay\");\n        }\n\n        if (supportsVoiceInput()) {\n            features.push(\"voiceinput\");\n        }\n\n        if (!browser.tv && !browser.xboxOne) {\n            browser.ps4;\n        }\n\n        if (supportsHtmlMediaAutoplay()) {\n            features.push(\"htmlaudioautoplay\");\n            features.push(\"htmlvideoautoplay\");\n        }\n\n        if (browser.edgeUwp) {\n            features.push(\"sync\");\n        }\n\n        if (supportsFullscreen()) {\n            features.push(\"fullscreenchange\");\n        }\n\n        if (browser.chrome || browser.edge && !browser.slow) {\n            if (!browser.noAnimation && !browser.edgeUwp && !browser.xboxOne) {\n                features.push(\"imageanalysis\");\n            }\n        }\n\n        if (browser.tv || browser.xboxOne || browser.ps4 || browser.mobile) {\n            features.push(\"physicalvolumecontrol\");\n        }\n\n        if (!browser.tv && !browser.xboxOne && !browser.ps4) {\n            features.push(\"remotecontrol\");\n        }\n\n        if (!browser.operaTv && !browser.tizen && !browser.orsay && !browser.web0s && !browser.edgeUwp) {\n            features.push(\"remotevideo\");\n        }\n\n        features.push(\"displaylanguage\");\n        features.push(\"otherapppromotions\");\n        features.push(\"displaymode\");\n        features.push(\"targetblank\");\n        // allows users to connect to more than one server\n        //features.push(\"multiserver\");\n        features.push(\"screensaver\");\n\n        if (!browser.orsay && !browser.msie && (browser.firefox || browser.ps4 || browser.edge || supportsCue())) {\n            features.push(\"subtitleappearancesettings\");\n        }\n\n        if (!browser.orsay) {\n            features.push(\"subtitleburnsettings\");\n        }\n\n        if (!browser.tv && !browser.ps4 && !browser.xboxOne) {\n            features.push(\"fileinput\");\n        }\n\n        if (browser.chrome) {\n            features.push(\"chromecast\");\n        }\n\n        return features;\n    }();\n\n    /**\n      * Do exit according to platform\n      */\n    function doExit() {\n        try {\n            if (window.NativeShell) {\n                window.NativeShell.AppHost.exit();\n            } else if (browser.tizen) {\n                tizen.application.getCurrentApplication().exit();\n            } else if (browser.web0s) {\n                webOS.platformBack();\n            } else {\n                window.close();\n            }\n        } catch (err) {\n            console.error(\"error closing application: \" + err);\n        }\n    }\n\n    var exitPromise;\n\n    /**\n      * Ask user for exit\n      */\n    function askForExit() {\n        if (exitPromise) {\n            return;\n        }\n\n        require([\"actionsheet\"], function (actionsheet) {\n            exitPromise = actionsheet.show({\n                title: Globalize.translate(\"MessageConfirmAppExit\"),\n                items: [\n                    {id: \"yes\", name: Globalize.translate(\"Yes\")},\n                    {id: \"no\", name: Globalize.translate(\"No\")}\n                ]\n            }).then(function (value) {\n                if (value === \"yes\") {\n                    doExit();\n                }\n            }).finally(function () {\n                exitPromise = null;\n            });\n        });\n    }\n\n    var deviceId;\n    var deviceName;\n    var appName = \"Jellyfin Web\";\n    var appVersion = \"10.5.0\";\n    var visibilityChange;\n    var visibilityState;\n\n    var appHost = {\n        getWindowState: function () {\n            return document.windowState || \"Normal\";\n        },\n        setWindowState: function (state) {\n            alert(\"setWindowState is not supported and should not be called\");\n        },\n        exit: function () {\n            if (!!window.appMode && browser.tizen) {\n                askForExit();\n            } else {\n                doExit();\n            }\n        },\n        supports: function (command) {\n            if (window.NativeShell) {\n                return window.NativeShell.AppHost.supports(command);\n            }\n\n            return -1 !== supportedFeatures.indexOf(command.toLowerCase());\n        },\n        preferVisualCards: browser.android || browser.chrome,\n        moreIcon: browser.android ? \"more_vert\" : \"more_horiz\",\n        getSyncProfile: getSyncProfile,\n        getDefaultLayout: function () {\n            if (window.NativeShell) {\n                return window.NativeShell.AppHost.getDefaultLayout();\n            }\n\n            return getDefaultLayout()\n        },\n        getDeviceProfile: getDeviceProfile,\n        init: function () {\n            if (window.NativeShell) {\n                return window.NativeShell.AppHost.init();\n            }\n\n            deviceName = getDeviceName();\n            getDeviceId().then(function (id) {\n                deviceId = id;\n            });\n        },\n        deviceName: function () {\n            return window.NativeShell ? window.NativeShell.AppHost.deviceName() : deviceName;\n        },\n        deviceId: function () {\n            return window.NativeShell ? window.NativeShell.AppHost.deviceId() : deviceId;\n        },\n        appName: function () {\n            return window.NativeShell ? window.NativeShell.AppHost.appName() : appName;\n        },\n        appVersion: function () {\n            return window.NativeShell ? window.NativeShell.AppHost.appVersion() : appVersion;\n        },\n        getPushTokenInfo: function () {\n            return {};\n        },\n        setThemeColor: function (color) {\n            var metaThemeColor = document.querySelector(\"meta[name=theme-color]\");\n\n            if (metaThemeColor) {\n                metaThemeColor.setAttribute(\"content\", color);\n            }\n        },\n        setUserScalable: function (scalable) {\n            if (!browser.tv) {\n                var att = scalable ? \"width=device-width, initial-scale=1, minimum-scale=1, user-scalable=yes\" : \"width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no\";\n                document.querySelector(\"meta[name=viewport]\").setAttribute(\"content\", att);\n            }\n        }\n    };\n\n    var doc = self.document;\n    var isHidden = false;\n\n    if (doc) {\n        if (void 0 !== doc.visibilityState) {\n            visibilityChange = \"visibilitychange\";\n            visibilityState = \"hidden\";\n        } else {\n            if (void 0 !== doc.mozHidden) {\n                visibilityChange = \"mozvisibilitychange\";\n                visibilityState = \"mozVisibilityState\";\n            } else {\n                if (void 0 !== doc.msHidden) {\n                    visibilityChange = \"msvisibilitychange\";\n                    visibilityState = \"msVisibilityState\";\n                } else {\n                    if (void 0 !== doc.webkitHidden) {\n                        visibilityChange = \"webkitvisibilitychange\";\n                        visibilityState = \"webkitVisibilityState\";\n                    }\n                }\n            }\n        }\n    }\n\n    if (doc) {\n        doc.addEventListener(visibilityChange, function () {\n            if (document[visibilityState]) {\n                onAppHidden();\n            } else {\n                onAppVisible();\n            }\n        });\n    }\n\n    if (self.addEventListener) {\n        self.addEventListener(\"focus\", onAppVisible);\n        self.addEventListener(\"blur\", onAppHidden);\n    }\n\n    return appHost;\n});\n"]}