{"version":3,"sources":["components/slideshow/slideshow.js"],"names":["define","dialogHelper","inputManager","connectionManager","layoutManager","focusManager","browser","appHost","loading","getImgUrl","item","original","apiClient","getApiClient","ServerId","imageOptions","maxWidth","screen","availWidth","BackdropImageTags","length","getBackdropImageUrl","options","type","width","maxHeight","height","quality","tag","getScaledImageUrl","Id","MediaType","getItemDownloadUrl","getImageUrl","ImageTags","AlbumId","AlbumPrimaryImageTag","getIcon","icon","cssClass","canFocus","autoFocus","setUserScalable","scalable","err","console","error","swiperInstance","dlg","currentTimeout","currentIntervalMs","currentOptions","currentIndex","onAutoplayStart","btnSlideshowPause","querySelector","classList","remove","add","onAutoplayStop","loadSwiper","slides","innerHTML","map","getSwiperSlideHtmlFromSlide","join","items","getSwiperSlideHtmlFromItem","require","Swiper","direction","loop","autoplay","delay","interval","preloadImages","lazy","loadPrevNext","disableOnInteraction","initialSlide","startIndex","speed","on","mobile","pause","play","imageUrl","originalImage","html","title","subtitle","description","previousImage","slidePrev","stopInterval","showNextImage","nextImage","activeIndex","close","slideNext","getCurrentImageInfo","slide","document","url","getAttribute","shareUrl","itemId","serverId","download","imageInfo","fileDownloader","share","navigator","start","stop","playPause","contains","onDialogClosed","destroy","off","window","onInputCommand","removeEventListener","PointerEvent","onPointerMove","startInterval","createElements","createDialog","exitAnimationDuration","interactive","size","scrollY","exitAnimation","removeOnClose","actionButtonsOnTop","supports","addEventListener","e","btnPause","btnDownload","btnShare","open","then","chromecast","hideTimeout","lastMouseMoveData","_osdOpen","isOsdOpen","getOsdBottom","showOsd","bottom","slideUpToShow","elem","onFinish","focus","animate","requestAnimationFrame","keyframes","transform","offsetHeight","opacity","offset","duration","iterations","easing","onfinish","startHideTimer","stopHideTimer","clearTimeout","setTimeout","hideOsd","slideDownToHide","pointerType","eventX","screenX","eventY","screenY","obj","x","y","Math","abs","detail","command","preventDefault","stopPropagation","index","skipPreload","max","imgUrl","onSrcLoaded","cardImageContainer","newCardImageContainer","createElement","className","cover","style","backgroundImage","parentNode","appendChild","showTitle","Name","onAnimationFinished","removeChild","img","Image","onload","src","this","show","hide","dialog"],"mappings":"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","file":"slideshow.js","sourcesContent":["define(['dialogHelper', 'inputManager', 'connectionManager', 'layoutManager', 'focusManager', 'browser', 'apphost', 'loading', 'css!./style', 'material-icons', 'paper-icon-button-light'], function (dialogHelper, inputManager, connectionManager, layoutManager, focusManager, browser, appHost, loading) {\n    'use strict';\n\n    function getImageUrl(item, options, apiClient) {\n\n        options = options || {};\n        options.type = options.type || \"Primary\";\n\n        if (typeof (item) === 'string') {\n            return apiClient.getScaledImageUrl(item, options);\n        }\n\n        if (item.ImageTags && item.ImageTags[options.type]) {\n\n            options.tag = item.ImageTags[options.type];\n            return apiClient.getScaledImageUrl(item.Id, options);\n        }\n\n        if (options.type === 'Primary') {\n            if (item.AlbumId && item.AlbumPrimaryImageTag) {\n\n                options.tag = item.AlbumPrimaryImageTag;\n                return apiClient.getScaledImageUrl(item.AlbumId, options);\n            }\n        }\n\n        return null;\n    }\n\n    function getBackdropImageUrl(item, options, apiClient) {\n\n        options = options || {};\n        options.type = options.type || \"Backdrop\";\n\n        // If not resizing, get the original image\n        if (!options.maxWidth && !options.width && !options.maxHeight && !options.height) {\n            options.quality = 100;\n        }\n\n        if (item.BackdropImageTags && item.BackdropImageTags.length) {\n\n            options.tag = item.BackdropImageTags[0];\n            return apiClient.getScaledImageUrl(item.Id, options);\n        }\n\n        return null;\n    }\n\n    function getImgUrl(item, original) {\n\n        var apiClient = connectionManager.getApiClient(item.ServerId);\n        var imageOptions = {};\n\n        if (!original) {\n            imageOptions.maxWidth = screen.availWidth;\n        }\n        if (item.BackdropImageTags && item.BackdropImageTags.length) {\n            return getBackdropImageUrl(item, imageOptions, apiClient);\n        } else {\n\n            if (item.MediaType === 'Photo' && original) {\n                return apiClient.getItemDownloadUrl(item.Id);\n            }\n            imageOptions.type = \"Primary\";\n            return getImageUrl(item, imageOptions, apiClient);\n        }\n    }\n\n    function getIcon(icon, cssClass, canFocus, autoFocus) {\n\n        var tabIndex = canFocus ? '' : ' tabindex=\"-1\"';\n        autoFocus = autoFocus ? ' autofocus' : '';\n        return '<button is=\"paper-icon-button-light\" class=\"autoSize ' + cssClass + '\"' + tabIndex + autoFocus + '><i class=\"material-icons slideshowButtonIcon ' + icon + '\"></i></button>';\n    }\n\n    function setUserScalable(scalable) {\n\n        try {\n            appHost.setUserScalable(scalable);\n        } catch (err) {\n            console.error('error in appHost.setUserScalable: ' + err);\n        }\n    }\n\n    return function (options) {\n\n        var self = this;\n        var swiperInstance;\n        var dlg;\n        var currentTimeout;\n        var currentIntervalMs;\n        var currentOptions;\n        var currentIndex;\n\n        // small hack since this is not possible anyway\n        if (browser.chromecast) {\n            options.interactive = false;\n        }\n\n        function createElements(options) {\n\n            dlg = dialogHelper.createDialog({\n                exitAnimationDuration: options.interactive ? 400 : 800,\n                size: 'fullscreen',\n                autoFocus: false,\n                scrollY: false,\n                exitAnimation: 'fadeout',\n                removeOnClose: true\n            });\n\n            dlg.classList.add('slideshowDialog');\n\n            var html = '';\n\n            if (options.interactive) {\n\n                var actionButtonsOnTop = layoutManager.mobile;\n\n                html += '<div>';\n                html += '<div class=\"slideshowSwiperContainer\"><div class=\"swiper-wrapper\"></div></div>';\n\n                html += getIcon('keyboard_arrow_left', 'btnSlideshowPrevious slideshowButton hide-mouse-idle-tv', false);\n                html += getIcon('keyboard_arrow_right', 'btnSlideshowNext slideshowButton hide-mouse-idle-tv', false);\n\n                html += '<div class=\"topActionButtons\">';\n                if (actionButtonsOnTop) {\n                    if (appHost.supports('filedownload')) {\n                        html += getIcon('file_download', 'btnDownload slideshowButton', true);\n                    }\n                    if (appHost.supports('sharing')) {\n                        html += getIcon('share', 'btnShare slideshowButton', true);\n                    }\n                }\n                html += getIcon('close', 'slideshowButton btnSlideshowExit hide-mouse-idle-tv', false);\n                html += '</div>';\n\n                if (!actionButtonsOnTop) {\n                    html += '<div class=\"slideshowBottomBar hide\">';\n\n                    html += getIcon('pause', 'btnSlideshowPause slideshowButton', true, true);\n                    if (appHost.supports('filedownload')) {\n                        html += getIcon('file_download', 'btnDownload slideshowButton', true);\n                    }\n                    if (appHost.supports('sharing')) {\n                        html += getIcon('share', 'btnShare slideshowButton', true);\n                    }\n\n                    html += '</div>';\n                }\n\n                html += '</div>';\n\n            } else {\n                html += '<div class=\"slideshowImage\"></div><h1 class=\"slideshowImageText\"></h1>';\n            }\n\n            dlg.innerHTML = html;\n\n            if (options.interactive) {\n                dlg.querySelector('.btnSlideshowExit').addEventListener('click', function (e) {\n\n                    dialogHelper.close(dlg);\n                });\n                dlg.querySelector('.btnSlideshowNext').addEventListener('click', nextImage);\n                dlg.querySelector('.btnSlideshowPrevious').addEventListener('click', previousImage);\n\n                var btnPause = dlg.querySelector('.btnSlideshowPause');\n                if (btnPause) {\n                    btnPause.addEventListener('click', playPause);\n                }\n\n                var btnDownload = dlg.querySelector('.btnDownload');\n                if (btnDownload) {\n                    btnDownload.addEventListener('click', download);\n                }\n\n                var btnShare = dlg.querySelector('.btnShare');\n                if (btnShare) {\n                    btnShare.addEventListener('click', share);\n                }\n            }\n\n            setUserScalable(true);\n\n            dialogHelper.open(dlg).then(function () {\n\n                setUserScalable(false);\n                stopInterval();\n            });\n\n            inputManager.on(window, onInputCommand);\n            document.addEventListener((window.PointerEvent ? 'pointermove' : 'mousemove'), onPointerMove);\n\n            dlg.addEventListener('close', onDialogClosed);\n\n            if (options.interactive) {\n                loadSwiper(dlg);\n            }\n        }\n\n        function onAutoplayStart() {\n            var btnSlideshowPause = dlg.querySelector('.btnSlideshowPause i');\n            if (btnSlideshowPause) {\n                btnSlideshowPause.classList.remove(\"play_arrow\");\n                btnSlideshowPause.classList.add(\"pause\");\n            }\n        }\n\n        function onAutoplayStop() {\n            var btnSlideshowPause = dlg.querySelector('.btnSlideshowPause i');\n            if (btnSlideshowPause) {\n                btnSlideshowPause.classList.remove(\"pause\");\n                btnSlideshowPause.classList.add(\"play_arrow\");\n            }\n        }\n\n        function loadSwiper(dlg) {\n\n            if (currentOptions.slides) {\n                dlg.querySelector('.swiper-wrapper').innerHTML = currentOptions.slides.map(getSwiperSlideHtmlFromSlide).join('');\n            } else {\n                dlg.querySelector('.swiper-wrapper').innerHTML = currentOptions.items.map(getSwiperSlideHtmlFromItem).join('');\n            }\n\n            require(['swiper'], function (Swiper) {\n\n                swiperInstance = new Swiper(dlg.querySelector('.slideshowSwiperContainer'), {\n                    // Optional parameters\n                    direction: 'horizontal',\n                    loop: options.loop !== false,\n                    autoplay: {\n                        delay: options.interval || 8000\n                    },\n                    // Disable preloading of all images\n                    preloadImages: false,\n                    // Enable lazy loading\n                    lazy: true,\n                    loadPrevNext: true,\n                    disableOnInteraction: false,\n                    initialSlide: options.startIndex || 0,\n                    speed: 240\n                });\n\n                swiperInstance.on('autoplayStart', onAutoplayStart);\n                swiperInstance.on('autoplayStop', onAutoplayStop);\n\n                if (layoutManager.mobile) {\n                    pause();\n                } else {\n                    play();\n                }\n            });\n        }\n\n        function getSwiperSlideHtmlFromItem(item) {\n\n            return getSwiperSlideHtmlFromSlide({\n                imageUrl: getImgUrl(item),\n                originalImage: getImgUrl(item, true),\n                //title: item.Name,\n                //description: item.Overview\n                Id: item.Id,\n                ServerId: item.ServerId\n            });\n        }\n\n        function getSwiperSlideHtmlFromSlide(item) {\n\n            var html = '';\n            html += '<div class=\"swiper-slide\" data-imageurl=\"' + item.imageUrl + '\" data-original=\"' + item.originalImage + '\" data-itemid=\"' + item.Id + '\" data-serverid=\"' + item.ServerId + '\">';\n            html += '<img data-src=\"' + item.imageUrl + '\" class=\"swiper-lazy swiper-slide-img\">';\n            if (item.title || item.subtitle) {\n                html += '<div class=\"slideText\">';\n                html += '<div class=\"slideTextInner\">';\n                if (item.title) {\n                    html += '<h1 class=\"slideTitle\">';\n                    html += item.title;\n                    html += '</h1>';\n                }\n                if (item.description) {\n                    html += '<div class=\"slideSubtitle\">';\n                    html += item.description;\n                    html += '</div>';\n                }\n                html += '</div>';\n                html += '</div>';\n            }\n            html += '</div>';\n\n            return html;\n        }\n\n        function previousImage() {\n            if (swiperInstance) {\n                swiperInstance.slidePrev();\n            } else {\n                stopInterval();\n                showNextImage(currentIndex - 1);\n            }\n        }\n\n        function nextImage() {\n            if (swiperInstance) {\n\n                if (options.loop === false) {\n\n                    if (swiperInstance.activeIndex >= swiperInstance.slides.length - 1) {\n                        dialogHelper.close(dlg);\n                        return;\n                    }\n                }\n\n                swiperInstance.slideNext();\n            } else {\n                stopInterval();\n                showNextImage(currentIndex + 1);\n            }\n        }\n\n        function getCurrentImageInfo() {\n\n            if (swiperInstance) {\n                var slide = document.querySelector('.swiper-slide-active');\n\n                if (slide) {\n                    return {\n                        url: slide.getAttribute('data-original'),\n                        shareUrl: slide.getAttribute('data-imageurl'),\n                        itemId: slide.getAttribute('data-itemid'),\n                        serverId: slide.getAttribute('data-serverid')\n                    };\n                }\n                return null;\n            } else {\n                return null;\n            }\n        }\n\n        function download() {\n\n            var imageInfo = getCurrentImageInfo();\n\n            require(['fileDownloader'], function (fileDownloader) {\n                fileDownloader.download([imageInfo]);\n            });\n        }\n\n        function share() {\n\n            var imageInfo = getCurrentImageInfo();\n\n            navigator.share({\n                url: imageInfo.shareUrl\n            });\n        }\n\n        function play() {\n            if (swiperInstance.autoplay) {\n                swiperInstance.autoplay.start();\n            }\n        }\n\n        function pause() {\n            if (swiperInstance.autoplay) {\n                swiperInstance.autoplay.stop();\n            }\n        }\n\n        function playPause() {\n            var paused = !dlg.querySelector('.btnSlideshowPause i').classList.contains(\"pause\");\n            if (paused) {\n                play();\n            } else {\n                pause();\n            }\n        }\n\n        function onDialogClosed() {\n\n            var swiper = swiperInstance;\n            if (swiper) {\n                swiper.destroy(true, true);\n                swiperInstance = null;\n            }\n\n            inputManager.off(window, onInputCommand);\n            document.removeEventListener((window.PointerEvent ? 'pointermove' : 'mousemove'), onPointerMove);\n        }\n\n        function startInterval(options) {\n\n            currentOptions = options;\n\n            stopInterval();\n            createElements(options);\n\n            if (!options.interactive) {\n                currentIntervalMs = options.interval || 11000;\n                showNextImage(options.startIndex || 0, true);\n            }\n        }\n\n        var _osdOpen = false;\n\n        function isOsdOpen() {\n            return _osdOpen;\n        }\n\n        function getOsdBottom() {\n            return dlg.querySelector('.slideshowBottomBar');\n        }\n\n        function showOsd() {\n\n            var bottom = getOsdBottom();\n            if (bottom) {\n                slideUpToShow(bottom);\n                startHideTimer();\n            }\n        }\n\n        function hideOsd() {\n\n            var bottom = getOsdBottom();\n            if (bottom) {\n                slideDownToHide(bottom);\n            }\n        }\n\n        var hideTimeout;\n\n        function startHideTimer() {\n            stopHideTimer();\n            hideTimeout = setTimeout(hideOsd, 4000);\n        }\n\n        function stopHideTimer() {\n            if (hideTimeout) {\n                clearTimeout(hideTimeout);\n                hideTimeout = null;\n            }\n        }\n\n        function slideUpToShow(elem) {\n\n            if (!elem.classList.contains('hide')) {\n                return;\n            }\n\n            _osdOpen = true;\n            elem.classList.remove('hide');\n\n            var onFinish = function () {\n                focusManager.focus(elem.querySelector('.btnSlideshowPause'));\n            };\n\n            if (!elem.animate) {\n                onFinish();\n                return;\n            }\n\n            requestAnimationFrame(function () {\n\n                var keyframes = [\n                    { transform: 'translate3d(0,' + elem.offsetHeight + 'px,0)', opacity: '.3', offset: 0 },\n                    { transform: 'translate3d(0,0,0)', opacity: '1', offset: 1 }\n                ];\n                var timing = { duration: 300, iterations: 1, easing: 'ease-out' };\n                elem.animate(keyframes, timing).onfinish = onFinish;\n            });\n        }\n\n        function slideDownToHide(elem) {\n\n            if (elem.classList.contains('hide')) {\n                return;\n            }\n\n            var onFinish = function () {\n                elem.classList.add('hide');\n                _osdOpen = false;\n            };\n\n            if (!elem.animate) {\n                onFinish();\n                return;\n            }\n\n            requestAnimationFrame(function () {\n\n                var keyframes = [\n                    { transform: 'translate3d(0,0,0)', opacity: '1', offset: 0 },\n                    { transform: 'translate3d(0,' + elem.offsetHeight + 'px,0)', opacity: '.3', offset: 1 }\n                ];\n                var timing = { duration: 300, iterations: 1, easing: 'ease-out' };\n                elem.animate(keyframes, timing).onfinish = onFinish;\n            });\n        }\n\n        var lastMouseMoveData;\n\n        function onPointerMove(e) {\n\n            var pointerType = e.pointerType || (layoutManager.mobile ? 'touch' : 'mouse');\n\n            if (pointerType === 'mouse') {\n                var eventX = e.screenX || 0;\n                var eventY = e.screenY || 0;\n\n                var obj = lastMouseMoveData;\n                if (!obj) {\n                    lastMouseMoveData = {\n                        x: eventX,\n                        y: eventY\n                    };\n                    return;\n                }\n\n                // if coord are same, it didn't move\n                if (Math.abs(eventX - obj.x) < 10 && Math.abs(eventY - obj.y) < 10) {\n                    return;\n                }\n\n                obj.x = eventX;\n                obj.y = eventY;\n\n                showOsd();\n            }\n        }\n\n        function onInputCommand(e) {\n\n            switch (e.detail.command) {\n\n                case 'left':\n                    if (!isOsdOpen()) {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        previousImage();\n                    }\n                    break;\n                case 'right':\n                    if (!isOsdOpen()) {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        nextImage();\n                    }\n                    break;\n                case 'up':\n                case 'down':\n                case 'select':\n                case 'menu':\n                case 'info':\n                case 'play':\n                case 'playpause':\n                case 'pause':\n                    showOsd();\n                    break;\n                default:\n                    break;\n            }\n        }\n\n        function showNextImage(index, skipPreload) {\n\n            index = Math.max(0, index);\n            if (index >= currentOptions.items.length) {\n                index = 0;\n            }\n            currentIndex = index;\n\n            var options = currentOptions;\n            var items = options.items;\n            var item = items[index];\n            var imgUrl = getImgUrl(item);\n\n            var onSrcLoaded = function () {\n                var cardImageContainer = dlg.querySelector('.slideshowImage');\n\n                var newCardImageContainer = document.createElement('div');\n                newCardImageContainer.className = cardImageContainer.className;\n\n                if (options.cover) {\n                    newCardImageContainer.classList.add('slideshowImage-cover');\n                }\n\n                newCardImageContainer.style.backgroundImage = \"url('\" + imgUrl + \"')\";\n                newCardImageContainer.classList.add('hide');\n                cardImageContainer.parentNode.appendChild(newCardImageContainer);\n\n                if (options.showTitle) {\n                    dlg.querySelector('.slideshowImageText').innerHTML = item.Name;\n                } else {\n                    dlg.querySelector('.slideshowImageText').innerHTML = '';\n                }\n\n                newCardImageContainer.classList.remove('hide');\n                var onAnimationFinished = function () {\n\n                    var parentNode = cardImageContainer.parentNode;\n                    if (parentNode) {\n                        parentNode.removeChild(cardImageContainer);\n                    }\n                };\n\n                if (newCardImageContainer.animate) {\n\n                    var keyframes = [\n                        { opacity: '0', offset: 0 },\n                        { opacity: '1', offset: 1 }\n                    ];\n                    var timing = { duration: 1200, iterations: 1 };\n                    newCardImageContainer.animate(keyframes, timing).onfinish = onAnimationFinished;\n                } else {\n                    onAnimationFinished();\n                }\n\n                stopInterval();\n                currentTimeout = setTimeout(function () {\n                    showNextImage(index + 1, true);\n\n                }, currentIntervalMs);\n            };\n\n            if (!skipPreload) {\n                var img = new Image();\n                img.onload = onSrcLoaded;\n                img.src = imgUrl;\n            } else {\n                onSrcLoaded();\n            }\n        }\n\n        function stopInterval() {\n            if (currentTimeout) {\n                clearTimeout(currentTimeout);\n                currentTimeout = null;\n            }\n        }\n\n        self.show = function () {\n            startInterval(options);\n        };\n\n        self.hide = function () {\n\n            var dialog = dlg;\n            if (dialog) {\n\n                dialogHelper.close(dialog);\n            }\n        };\n    };\n});\n"]}