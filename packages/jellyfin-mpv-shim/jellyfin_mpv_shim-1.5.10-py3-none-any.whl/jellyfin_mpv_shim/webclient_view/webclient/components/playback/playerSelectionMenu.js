"use strict";define(["appSettings","events","browser","loading","playbackManager","appRouter","globalize","apphost"],(function(appSettings,events,browser,loading,playbackManager,appRouter,globalize,appHost){function mirrorIfEnabled(info){if(info&&playbackManager.enableDisplayMirroring()){var getPlayerInfo=playbackManager.getPlayerInfo();getPlayerInfo&&(getPlayerInfo.isLocalPlayer||-1===getPlayerInfo.supportedCommands.indexOf("DisplayContent")||function mirrorItem(info,player){var item=info.item;playbackManager.displayContent({ItemName:item.Name,ItemId:item.Id,ItemType:item.Type,Context:info.context},player)}(info,playbackManager.getCurrentPlayer()))}}function emptyCallback(){}function getIcon(target){var deviceType=target.deviceType;switch(!deviceType&&target.isLocalPlayer&&(deviceType=browser.tv?"tv":browser.mobile?"smartphone":"desktop"),deviceType||(deviceType="tv"),deviceType){case"smartphone":return"smartphone";case"tablet":return"tablet";case"tv":return"tv";case"cast":return"cast";case"desktop":return"computer";default:return"tv"}}function onMirrorChange(){playbackManager.enableDisplayMirroring(this.checked)}return document.addEventListener("viewshow",(function(e){var item=(e.detail.state||{}).item;item&&item.ServerId&&mirrorIfEnabled({item:item})})),events.on(appSettings,"change",(function(e,name){"displaymirror"===name&&mirrorIfEnabled()})),events.on(playbackManager,"pairing",(function(e){loading.show()})),events.on(playbackManager,"paired",(function(e){loading.hide()})),events.on(playbackManager,"pairerror",(function(e){loading.hide()})),{show:function showPlayerSelection(button){var currentPlayerInfo=playbackManager.getPlayerInfo();if(!currentPlayerInfo||currentPlayerInfo.isLocalPlayer){var currentPlayerId=currentPlayerInfo?currentPlayerInfo.id:null;loading.show(),playbackManager.getTargets().then((function(targets){var menuItems=targets.map((function(t){var target,name=t.name;return t.appName&&t.appName!==t.name&&(name+=" - "+t.appName),{name:name,id:t.id,selected:currentPlayerId===t.id,secondaryText:(target=t,target.user?target.user.Name:null),icon:getIcon(t)}}));require(["actionsheet"],(function(actionsheet){loading.hide();var menuOptions={title:globalize.translate("HeaderPlayOn"),items:menuItems,positionTo:button,resolveOnClick:!0,border:!0};browser.chrome&&!appHost.supports("castmenuhashchange")&&(menuOptions.enableHistory=!1),actionsheet.show(menuOptions).then((function(id){var target=targets.filter((function(t){return t.id===id}))[0];playbackManager.trySetActivePlayer(target.playerName,target),mirrorIfEnabled()}),emptyCallback)}))}))}else(function showActivePlayerMenu(playerInfo){require(["dialogHelper","dialog","emby-checkbox","emby-button"],(function(dialogHelper){!function showActivePlayerMenuInternal(dialogHelper,playerInfo){var html="",dialogOptions={removeOnClose:!0,modal:!1,entryAnimationDuration:160,exitAnimationDuration:160,autoFocus:!1},dlg=dialogHelper.createDialog(dialogOptions);dlg.classList.add("promptDialog");var currentDeviceName=playerInfo.deviceName||playerInfo.name;if(html+='<div class="promptDialogContent" style="padding:1.5em;">',html+='<h2 style="margin-top:.5em;">',html+=currentDeviceName,html+="</h2>",html+="<div>",-1!==playerInfo.supportedCommands.indexOf("DisplayContent")){html+='<label class="checkboxContainer">';var checkedHtml=playbackManager.enableDisplayMirroring()?" checked":"";html+='<input type="checkbox" is="emby-checkbox" class="chkMirror"'+checkedHtml+"/>",html+="<span>"+globalize.translate("EnableDisplayMirroring")+"</span>",html+="</label>"}html+="</div>",html+='<div style="margin-top:1em;display:flex;justify-content: flex-end;">',html+='<button is="emby-button" type="button" class="button-flat btnRemoteControl promptDialogButton">'+globalize.translate("HeaderRemoteControl")+"</button>",html+='<button is="emby-button" type="button" class="button-flat btnDisconnect promptDialogButton ">'+globalize.translate("Disconnect")+"</button>",html+='<button is="emby-button" type="button" class="button-flat btnCancel promptDialogButton">'+globalize.translate("ButtonCancel")+"</button>",html+="</div>",html+="</div>",dlg.innerHTML=html;var chkMirror=dlg.querySelector(".chkMirror");chkMirror&&chkMirror.addEventListener("change",onMirrorChange);var destination="",btnRemoteControl=dlg.querySelector(".btnRemoteControl");btnRemoteControl&&btnRemoteControl.addEventListener("click",(function(){destination="nowplaying",dialogHelper.close(dlg)}));dlg.querySelector(".btnDisconnect").addEventListener("click",(function(){destination="disconnectFromPlayer",dialogHelper.close(dlg)})),dlg.querySelector(".btnCancel").addEventListener("click",(function(){dialogHelper.close(dlg)})),dialogHelper.open(dlg).then((function(){"nowplaying"===destination?appRouter.showNowPlaying():"disconnectFromPlayer"===destination&&function disconnectFromPlayer(currentDeviceName){-1!==playbackManager.getSupportedCommands().indexOf("EndSession")?require(["dialog"],(function(dialog){var menuItems=[];menuItems.push({name:globalize.translate("Yes"),id:"yes"}),menuItems.push({name:globalize.translate("No"),id:"no"}),dialog({buttons:menuItems,text:globalize.translate("ConfirmEndPlayerSession",currentDeviceName)}).then((function(id){switch(id){case"yes":playbackManager.getCurrentPlayer().endSession(),playbackManager.setDefaultPlayerActive();break;case"no":playbackManager.setDefaultPlayerActive()}}))})):playbackManager.setDefaultPlayerActive()}(currentDeviceName)}),emptyCallback)}(dialogHelper,playerInfo)}))})(currentPlayerInfo)}}}));
//# sourceMappingURL=playerSelectionMenu.js.map
