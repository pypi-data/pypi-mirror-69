{"version":3,"sources":["components/collectioneditor/collectioneditor.js"],"names":["define","dialogHelper","loading","appHost","layoutManager","connectionManager","appRouter","globalize","currentServerId","onSubmit","e","show","panel","parentWithClass","elem","className","classList","contains","parentNode","this","collectionId","querySelector","value","apiClient","getApiClient","addToCollection","dlg","id","url","getUrl","Ids","ajax","type","then","hide","submitted","close","require","toast","translate","createCollection","Name","IsLocked","checked","dataType","result","Id","redirectToCollection","showItem","serverId","preventDefault","triggerChange","select","dispatchEvent","CustomEvent","initEditor","content","items","addEventListener","add","removeAttribute","remove","setAttribute","join","length","populateCollections","getItems","getCurrentUserId","Recursive","IncludeItemTypes","SortBy","EnableTotalRecordCount","html","Items","map","i","innerHTML","selectCollectionToAddTo","centerFocus","horiz","on","scrollHelper","fn","CollectionEditor","prototype","options","dialogOptions","removeOnClose","scrollY","tv","size","createDialog","supports","getEditorHtml","open","Promise","resolve","reject"],"mappings":"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","file":"collectioneditor.js","sourcesContent":["define(['dialogHelper', 'loading', 'apphost', 'layoutManager', 'connectionManager', 'appRouter', 'globalize', 'emby-checkbox', 'emby-input', 'paper-icon-button-light', 'emby-select', 'material-icons', 'css!./../formdialog', 'emby-button', 'flexStyles'], function (dialogHelper, loading, appHost, layoutManager, connectionManager, appRouter, globalize) {\n    'use strict';\n\n    var currentServerId;\n\n    function parentWithClass(elem, className) {\n\n        while (!elem.classList || !elem.classList.contains(className)) {\n            elem = elem.parentNode;\n\n            if (!elem) {\n                return null;\n            }\n        }\n\n        return elem;\n    }\n\n    function onSubmit(e) {\n        loading.show();\n\n        var panel = parentWithClass(this, 'dialog');\n\n        var collectionId = panel.querySelector('#selectCollectionToAddTo').value;\n\n        var apiClient = connectionManager.getApiClient(currentServerId);\n\n        if (collectionId) {\n            addToCollection(apiClient, panel, collectionId);\n        } else {\n            createCollection(apiClient, panel);\n        }\n\n        e.preventDefault();\n        return false;\n    }\n\n    function createCollection(apiClient, dlg) {\n\n        var url = apiClient.getUrl(\"Collections\", {\n\n            Name: dlg.querySelector('#txtNewCollectionName').value,\n            IsLocked: !dlg.querySelector('#chkEnableInternetMetadata').checked,\n            Ids: dlg.querySelector('.fldSelectedItemIds').value || ''\n        });\n\n        apiClient.ajax({\n            type: \"POST\",\n            url: url,\n            dataType: \"json\"\n\n        }).then(function (result) {\n\n            loading.hide();\n\n            var id = result.Id;\n\n            dlg.submitted = true;\n            dialogHelper.close(dlg);\n            redirectToCollection(apiClient, id);\n\n        });\n    }\n\n    function redirectToCollection(apiClient, id) {\n\n        appRouter.showItem(id, apiClient.serverId());\n    }\n\n    function addToCollection(apiClient, dlg, id) {\n\n        var url = apiClient.getUrl(\"Collections/\" + id + \"/Items\", {\n\n            Ids: dlg.querySelector('.fldSelectedItemIds').value || ''\n        });\n\n        apiClient.ajax({\n            type: \"POST\",\n            url: url\n\n        }).then(function () {\n\n            loading.hide();\n\n            dlg.submitted = true;\n            dialogHelper.close(dlg);\n\n            require(['toast'], function (toast) {\n                toast(globalize.translate('MessageItemsAdded'));\n            });\n        });\n    }\n\n    function triggerChange(select) {\n        select.dispatchEvent(new CustomEvent('change', {}));\n    }\n\n    function populateCollections(panel) {\n\n        loading.show();\n\n        var select = panel.querySelector('#selectCollectionToAddTo');\n\n        panel.querySelector('.newCollectionInfo').classList.add('hide');\n\n        var options = {\n\n            Recursive: true,\n            IncludeItemTypes: \"BoxSet\",\n            SortBy: \"SortName\",\n            EnableTotalRecordCount: false\n        };\n\n        var apiClient = connectionManager.getApiClient(currentServerId);\n        apiClient.getItems(apiClient.getCurrentUserId(), options).then(function (result) {\n\n            var html = '';\n\n            html += '<option value=\"\">' + globalize.translate('OptionNew') + '</option>';\n\n            html += result.Items.map(function (i) {\n\n                return '<option value=\"' + i.Id + '\">' + i.Name + '</option>';\n            });\n\n            select.innerHTML = html;\n            select.value = '';\n            triggerChange(select);\n\n            loading.hide();\n        });\n    }\n\n    function getEditorHtml() {\n\n        var html = '';\n\n        html += '<div class=\"formDialogContent smoothScrollY\" style=\"padding-top:2em;\">';\n        html += '<div class=\"dialogContentInner dialog-content-centered\">';\n        html += '<form class=\"newCollectionForm\" style=\"margin:auto;\">';\n\n        html += '<div>';\n        html += globalize.translate('NewCollectionHelp');\n        html += '</div>';\n\n        html += '<div class=\"fldSelectCollection\">';\n        html += '<br/>';\n        html += '<br/>';\n        html += '<div class=\"selectContainer\">';\n        html += '<select is=\"emby-select\" label=\"' + globalize.translate('LabelCollection') + '\" id=\"selectCollectionToAddTo\" autofocus></select>';\n        html += '</div>';\n        html += '</div>';\n\n        html += '<div class=\"newCollectionInfo\">';\n\n        html += '<div class=\"inputContainer\">';\n        html += '<input is=\"emby-input\" type=\"text\" id=\"txtNewCollectionName\" required=\"required\" label=\"' + globalize.translate('LabelName') + '\" />';\n        html += '<div class=\"fieldDescription\">' + globalize.translate('NewCollectionNameExample') + '</div>';\n        html += '</div>';\n\n        html += '<label class=\"checkboxContainer\">';\n        html += '<input is=\"emby-checkbox\" type=\"checkbox\" id=\"chkEnableInternetMetadata\" />';\n        html += '<span>' + globalize.translate('SearchForCollectionInternetMetadata') + '</span>';\n        html += '</label>';\n\n        // newCollectionInfo\n        html += '</div>';\n\n        html += '<div class=\"formDialogFooter\">';\n        html += '<button is=\"emby-button\" type=\"submit\" class=\"raised btnSubmit block formDialogFooterItem button-submit\">' + globalize.translate('ButtonOk') + '</button>';\n        html += '</div>';\n\n        html += '<input type=\"hidden\" class=\"fldSelectedItemIds\" />';\n\n        html += '</form>';\n        html += '</div>';\n        html += '</div>';\n\n        return html;\n    }\n\n    function initEditor(content, items) {\n\n        content.querySelector('#selectCollectionToAddTo').addEventListener('change', function () {\n            if (this.value) {\n                content.querySelector('.newCollectionInfo').classList.add('hide');\n                content.querySelector('#txtNewCollectionName').removeAttribute('required');\n            } else {\n                content.querySelector('.newCollectionInfo').classList.remove('hide');\n                content.querySelector('#txtNewCollectionName').setAttribute('required', 'required');\n            }\n        });\n\n        content.querySelector('form').addEventListener('submit', onSubmit);\n\n        content.querySelector('.fldSelectedItemIds', content).value = items.join(',');\n\n        if (items.length) {\n            content.querySelector('.fldSelectCollection').classList.remove('hide');\n            populateCollections(content);\n        } else {\n            content.querySelector('.fldSelectCollection').classList.add('hide');\n\n            var selectCollectionToAddTo = content.querySelector('#selectCollectionToAddTo');\n            selectCollectionToAddTo.innerHTML = '';\n            selectCollectionToAddTo.value = '';\n            triggerChange(selectCollectionToAddTo);\n        }\n    }\n\n    function centerFocus(elem, horiz, on) {\n        require(['scrollHelper'], function (scrollHelper) {\n            var fn = on ? 'on' : 'off';\n            scrollHelper.centerFocus[fn](elem, horiz);\n        });\n    }\n\n    function CollectionEditor() {\n\n    }\n\n    CollectionEditor.prototype.show = function (options) {\n\n        var items = options.items || {};\n        currentServerId = options.serverId;\n\n        var dialogOptions = {\n            removeOnClose: true,\n            scrollY: false\n        };\n\n        if (layoutManager.tv) {\n            dialogOptions.size = 'fullscreen';\n        } else {\n            dialogOptions.size = 'small';\n        }\n\n        var dlg = dialogHelper.createDialog(dialogOptions);\n\n        dlg.classList.add('formDialog');\n\n        var html = '';\n        var title = items.length ? globalize.translate('HeaderAddToCollection') : globalize.translate('NewCollection');\n\n        html += '<div class=\"formDialogHeader\">';\n        html += '<button is=\"paper-icon-button-light\" class=\"btnCancel autoSize\" tabindex=\"-1\"><i class=\"material-icons arrow_back\"></i></button>';\n        html += '<h3 class=\"formDialogHeaderTitle\">';\n        html += title;\n        html += '</h3>';\n\n        if (appHost.supports('externallinks')) {\n            html += '<a is=\"emby-linkbutton\" class=\"button-link btnHelp flex align-items-center\" href=\"https://web.archive.org/web/20181216120305/https://github.com/MediaBrowser/Wiki/wiki/Collections\" target=\"_blank\" style=\"margin-left:auto;margin-right:.5em;padding:.25em;\" title=\"' + globalize.translate('Help') + '\"><i class=\"material-icons\">info</i><span style=\"margin-left:.25em;\">' + globalize.translate('Help') + '</span></a>';\n        }\n\n        html += '</div>';\n\n        html += getEditorHtml();\n\n        dlg.innerHTML = html;\n\n        initEditor(dlg, items);\n\n        dlg.querySelector('.btnCancel').addEventListener('click', function () {\n\n            dialogHelper.close(dlg);\n        });\n\n        if (layoutManager.tv) {\n            centerFocus(dlg.querySelector('.formDialogContent'), false, true);\n        }\n\n        return dialogHelper.open(dlg).then(function () {\n\n            if (layoutManager.tv) {\n                centerFocus(dlg.querySelector('.formDialogContent'), false, false);\n            }\n\n            if (dlg.submitted) {\n                return Promise.resolve();\n            }\n\n            return Promise.reject();\n        });\n    };\n\n    return CollectionEditor;\n});\n"]}