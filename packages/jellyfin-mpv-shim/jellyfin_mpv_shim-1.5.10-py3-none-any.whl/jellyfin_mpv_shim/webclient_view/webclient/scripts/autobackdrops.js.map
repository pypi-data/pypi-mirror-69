{"version":3,"sources":["scripts/autobackdrops.js"],"names":["define","backdrop","userSettings","libraryMenu","showBackdrop","type","parentId","apiClient","window","ApiClient","getBackdropItemIds","userId","types","key","data","cache","console","debug","JSON","parse","Promise","resolve","options","SortBy","Limit","Recursive","IncludeItemTypes","ImageTypes","ParentId","EnableTotalRecordCount","getItems","getCurrentUserId","then","result","images","Items","map","i","Id","tag","BackdropImageTags","ServerId","stringify","length","setBackdrops","clear","pageClassOn","this","classList","contains","enabled","enableBackdrops","remove","getAttribute","getTopParentId"],"mappings":"AAAA,aAAAA,OAAO,CAAC,WAAY,eAAgB,gBAAgB,SAAUC,SAAUC,aAAcC,aAuClF,SAASC,aAAaC,KAAMC,UACxB,IAAIC,UAAYC,OAAOC,UAEnBF,WAnCR,SAASG,mBAAmBH,UAAWI,OAAQC,MAAON,UAClD,IAAIO,IAAM,cAAgBF,QAAUC,OAAS,KAAON,UAAY,IAC5DQ,KAAOC,MAAMF,KAEjB,GAAIC,KAGA,OAFAE,QAAQC,MAAM,yCAA2CJ,KACzDC,KAAOI,KAAKC,MAAML,MACXM,QAAQC,QAAQP,MAG3B,IAAIQ,QAAU,CACVC,OAAQ,2BACRC,MAAO,GACPC,WAAW,EACXC,iBAAkBd,MAClBe,WAAY,WACZC,SAAUtB,SACVuB,wBAAwB,GAE5B,OAAOtB,UAAUuB,SAASvB,UAAUwB,mBAAoBT,SAASU,MAAK,SAAUC,QAC5E,IAAIC,OAASD,OAAOE,MAAMC,KAAI,SAAUC,GACpC,MAAO,CACHC,GAAID,EAAEC,GACNC,IAAKF,EAAEG,kBAAkB,GACzBC,SAAUJ,EAAEI,aAIpB,OADA1B,MAAMF,KAAOK,KAAKwB,UAAUR,QACrBA,UAQPxB,CAAmBH,UAAWA,UAAUwB,mBAAoB1B,KAAMC,UAAU0B,MAAK,SAAUE,QACnFA,OAAOS,OACP1C,SAAS2C,aAAaV,OAAOE,KAAI,SAAUC,GAEvC,OADAA,EAAEG,kBAAoB,CAACH,EAAEE,KAClBF,MAGXpC,SAAS4C,WAMzB,IAAI9B,MAAQ,GACZ+B,YAAY,WAAY,QAAQ,WACjBC,KAEDC,UAAUC,SAAS,sBAFlBF,KAGEC,UAAUC,SAAS,iBA1DpC,SAASC,UACL,OAAOhD,aAAaiD,kBA0DRD,IAJDH,KASMC,UAAUI,OAAO,gBACtBnD,SAAS4C,SAHTzC,aAPD2C,KAKiBM,aAAa,qBAL9BN,KAMqBC,UAAUC,SAAS,sBAAwB,GAAK9C,YAAYmD,kBAOpFrD,SAAS4C","file":"autobackdrops.js","sourcesContent":["define([\"backdrop\", \"userSettings\", \"libraryMenu\"], function (backdrop, userSettings, libraryMenu) {\n    \"use strict\";\n\n    function enabled() {\n        return userSettings.enableBackdrops();\n    }\n\n    function getBackdropItemIds(apiClient, userId, types, parentId) {\n        var key = \"backdrops2_\" + userId + (types || \"\") + (parentId || \"\");\n        var data = cache[key];\n\n        if (data) {\n            console.debug(\"Found backdrop id list in cache. Key: \" + key);\n            data = JSON.parse(data);\n            return Promise.resolve(data);\n        }\n\n        var options = {\n            SortBy: \"IsFavoriteOrLiked,Random\",\n            Limit: 20,\n            Recursive: true,\n            IncludeItemTypes: types,\n            ImageTypes: \"Backdrop\",\n            ParentId: parentId,\n            EnableTotalRecordCount: false\n        };\n        return apiClient.getItems(apiClient.getCurrentUserId(), options).then(function (result) {\n            var images = result.Items.map(function (i) {\n                return {\n                    Id: i.Id,\n                    tag: i.BackdropImageTags[0],\n                    ServerId: i.ServerId\n                };\n            });\n            cache[key] = JSON.stringify(images);\n            return images;\n        });\n    }\n\n    function showBackdrop(type, parentId) {\n        var apiClient = window.ApiClient;\n\n        if (apiClient) {\n            getBackdropItemIds(apiClient, apiClient.getCurrentUserId(), type, parentId).then(function (images) {\n                if (images.length) {\n                    backdrop.setBackdrops(images.map(function (i) {\n                        i.BackdropImageTags = [i.tag];\n                        return i;\n                    }));\n                } else {\n                    backdrop.clear();\n                }\n            });\n        }\n    }\n\n    var cache = {};\n    pageClassOn(\"pageshow\", \"page\", function () {\n        var page = this;\n\n        if (!page.classList.contains(\"selfBackdropPage\")) {\n            if (page.classList.contains(\"backdropPage\")) {\n                if (enabled()) {\n                    var type = page.getAttribute(\"data-backdroptype\");\n                    var parentId = page.classList.contains(\"globalBackdropPage\") ? \"\" : libraryMenu.getTopParentId();\n                    showBackdrop(type, parentId);\n                } else {\n                    page.classList.remove(\"backdropPage\");\n                    backdrop.clear();\n                }\n            } else {\n                backdrop.clear();\n            }\n        }\n    });\n});\n"]}