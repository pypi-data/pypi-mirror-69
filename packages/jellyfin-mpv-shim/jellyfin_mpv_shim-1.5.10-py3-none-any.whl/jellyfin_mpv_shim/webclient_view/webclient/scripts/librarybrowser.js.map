{"version":3,"sources":["scripts/librarybrowser.js"],"names":["define","userSettings","libraryBrowser","getSavedQueryKey","modifier","window","location","href","split","loadSavedQueryValues","key","query","values","get","JSON","parse","Object","assign","saveQueryValues","SortBy","SortOrder","set","stringify","saveViewSetting","value","getSavedView","showLayoutMenu","button","currentLayout","views","dispatchEvent","getAttribute","menuItems","map","v","name","Globalize","translate","id","selected","require","actionsheet","show","items","positionTo","callback","CustomEvent","detail","viewStyle","bubbles","cancelable","$","trigger","getQueryPagingHtml","options","startIndex","limit","totalRecordCount","html","recordsEnd","Math","min","showControls","viewButton","filterButton","sortButton","addLayoutButton","layouts","showSortMenu","dialogHelper","onSortByChange","newValue","this","checked","changed","replace","StartIndex","onSortOrderChange","dlg","createDialog","removeOnClose","modal","entryAnimationDuration","exitAnimationDuration","classList","add","i","length","isChecked","option","radioValue","innerHTML","open","sortBys","querySelectorAll","addEventListener","sortOrders","LibraryBrowser"],"mappings":"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","file":"librarybrowser.js","sourcesContent":["define([\"userSettings\"], function (userSettings) {\n    \"use strict\";\n\n    var libraryBrowser = {\n        getSavedQueryKey: function (modifier) {\n            return window.location.href.split(\"#\")[0] + (modifier || \"\");\n        },\n        loadSavedQueryValues: function (key, query) {\n            var values = userSettings.get(key);\n\n            if (values) {\n                values = JSON.parse(values);\n                return Object.assign(query, values);\n            }\n\n            return query;\n        },\n        saveQueryValues: function (key, query) {\n            var values = {};\n\n            if (query.SortBy) {\n                values.SortBy = query.SortBy;\n            }\n\n            if (query.SortOrder) {\n                values.SortOrder = query.SortOrder;\n            }\n\n            userSettings.set(key, JSON.stringify(values));\n        },\n        saveViewSetting: function (key, value) {\n            userSettings.set(key + \"-_view\", value);\n        },\n        getSavedView: function (key) {\n            return userSettings.get(key + \"-_view\");\n        },\n        showLayoutMenu: function (button, currentLayout, views) {\n            var dispatchEvent = true;\n\n            if (!views) {\n                dispatchEvent = false;\n                views = button.getAttribute(\"data-layouts\");\n                views = views ? views.split(\",\") : [\"List\", \"Poster\", \"PosterCard\", \"Thumb\", \"ThumbCard\"];\n            }\n\n            var menuItems = views.map(function (v) {\n                return {\n                    name: Globalize.translate(\"Option\" + v),\n                    id: v,\n                    selected: currentLayout == v\n                };\n            });\n\n            require([\"actionsheet\"], function (actionsheet) {\n                actionsheet.show({\n                    items: menuItems,\n                    positionTo: button,\n                    callback: function (id) {\n                        button.dispatchEvent(new CustomEvent(\"layoutchange\", {\n                            detail: {\n                                viewStyle: id\n                            },\n                            bubbles: true,\n                            cancelable: false\n                        }));\n\n                        if (!dispatchEvent) {\n                            if (window.$) {\n                                $(button).trigger(\"layoutchange\", [id]);\n                            }\n                        }\n                    }\n                });\n            });\n        },\n        getQueryPagingHtml: function (options) {\n            var startIndex = options.startIndex;\n            var limit = options.limit;\n            var totalRecordCount = options.totalRecordCount;\n            var html = \"\";\n            var recordsEnd = Math.min(startIndex + limit, totalRecordCount);\n            var showControls = limit < totalRecordCount;\n\n            if (html += '<div class=\"listPaging\">', showControls) {\n                html += '<span style=\"vertical-align:middle;\">';\n                html += (totalRecordCount ? startIndex + 1 : 0) + \"-\" + recordsEnd + \" of \" + totalRecordCount;\n                html += \"</span>\";\n            }\n\n            if (showControls || options.viewButton || options.filterButton || options.sortButton || options.addLayoutButton) {\n                html += '<div style=\"display:inline-block;\">';\n\n                if (showControls) {\n                    html += '<button is=\"paper-icon-button-light\" class=\"btnPreviousPage autoSize\" ' + (startIndex ? \"\" : \"disabled\") + '><i class=\"material-icons arrow_back\"></i></button>';\n                    html += '<button is=\"paper-icon-button-light\" class=\"btnNextPage autoSize\" ' + (startIndex + limit >= totalRecordCount ? \"disabled\" : \"\") + '><i class=\"material-icons arrow_forward\"></i></button>';\n                }\n\n                if (options.addLayoutButton) {\n                    html += '<button is=\"paper-icon-button-light\" title=\"' + Globalize.translate(\"ButtonSelectView\") + '\" class=\"btnChangeLayout autoSize\" data-layouts=\"' + (options.layouts || \"\") + '\" onclick=\"LibraryBrowser.showLayoutMenu(this, \\'' + (options.currentLayout || \"\") + '\\');\"><i class=\"material-icons view_comfy\"></i></button>';\n                }\n\n                if (options.sortButton) {\n                    html += '<button is=\"paper-icon-button-light\" class=\"btnSort autoSize\" title=\"' + Globalize.translate(\"ButtonSort\") + '\"><i class=\"material-icons sort_by_alpha\"></i></button>';\n                }\n\n                if (options.filterButton) {\n                    html += '<button is=\"paper-icon-button-light\" class=\"btnFilter autoSize\" title=\"' + Globalize.translate(\"ButtonFilter\") + '\"><i class=\"material-icons filter_list\"></i></button>';\n                }\n\n                html += \"</div>\";\n            }\n\n            return html += \"</div>\";\n        },\n        showSortMenu: function (options) {\n            require([\"dialogHelper\", \"emby-radio\"], function (dialogHelper) {\n                function onSortByChange() {\n                    var newValue = this.value;\n\n                    if (this.checked) {\n                        var changed = options.query.SortBy != newValue;\n                        options.query.SortBy = newValue.replace(\"_\", \",\");\n                        options.query.StartIndex = 0;\n\n                        if (options.callback && changed) {\n                            options.callback();\n                        }\n                    }\n                }\n\n                function onSortOrderChange() {\n                    var newValue = this.value;\n\n                    if (this.checked) {\n                        var changed = options.query.SortOrder != newValue;\n                        options.query.SortOrder = newValue;\n                        options.query.StartIndex = 0;\n\n                        if (options.callback && changed) {\n                            options.callback();\n                        }\n                    }\n                }\n\n                var dlg = dialogHelper.createDialog({\n                    removeOnClose: true,\n                    modal: false,\n                    entryAnimationDuration: 160,\n                    exitAnimationDuration: 200\n                });\n                dlg.classList.add(\"ui-body-a\");\n                dlg.classList.add(\"background-theme-a\");\n                dlg.classList.add(\"formDialog\");\n                var html = \"\";\n                html += '<div style=\"margin:0;padding:1.25em 1.5em 1.5em;\">';\n                html += '<h2 style=\"margin:0 0 .5em;\">';\n                html += Globalize.translate(\"HeaderSortBy\");\n                html += \"</h2>\";\n                var i;\n                var length;\n                var isChecked;\n                html += '<div>';\n                for (i = 0, length = options.items.length; i < length; i++) {\n                    var option = options.items[i];\n                    var radioValue = option.id.replace(\",\", \"_\");\n                    isChecked = (options.query.SortBy || \"\").replace(\",\", \"_\") == radioValue ? \" checked\" : \"\";\n                    html += '<label class=\"radio-label-block\"><input type=\"radio\" is=\"emby-radio\" name=\"SortBy\" data-id=\"' + option.id + '\" value=\"' + radioValue + '\" class=\"menuSortBy\" ' + isChecked + \" /><span>\" + option.name + \"</span></label>\";\n                }\n\n                html += \"</div>\";\n                html += '<h2 style=\"margin: 1em 0 .5em;\">';\n                html += Globalize.translate(\"HeaderSortOrder\");\n                html += \"</h2>\";\n                html += \"<div>\";\n                isChecked = \"Ascending\" == options.query.SortOrder ? \" checked\" : \"\";\n                html += '<label class=\"radio-label-block\"><input type=\"radio\" is=\"emby-radio\" name=\"SortOrder\" value=\"Ascending\" class=\"menuSortOrder\" ' + isChecked + \" /><span>\" + Globalize.translate(\"OptionAscending\") + \"</span></label>\";\n                isChecked = \"Descending\" == options.query.SortOrder ? \" checked\" : \"\";\n                html += '<label class=\"radio-label-block\"><input type=\"radio\" is=\"emby-radio\" name=\"SortOrder\" value=\"Descending\" class=\"menuSortOrder\" ' + isChecked + \" /><span>\" + Globalize.translate(\"OptionDescending\") + \"</span></label>\";\n                html += \"</div>\";\n                html += \"</div>\";\n                dlg.innerHTML = html;\n                dialogHelper.open(dlg);\n                var sortBys = dlg.querySelectorAll(\".menuSortBy\");\n\n                for (i = 0, length = sortBys.length; i < length; i++) {\n                    sortBys[i].addEventListener(\"change\", onSortByChange);\n                }\n\n                var sortOrders = dlg.querySelectorAll(\".menuSortOrder\");\n\n                for (i = 0, length = sortOrders.length; i < length; i++) {\n                    sortOrders[i].addEventListener(\"change\", onSortOrderChange);\n                }\n            });\n        }\n    };\n    window.LibraryBrowser = libraryBrowser;\n    return libraryBrowser;\n});\n"]}