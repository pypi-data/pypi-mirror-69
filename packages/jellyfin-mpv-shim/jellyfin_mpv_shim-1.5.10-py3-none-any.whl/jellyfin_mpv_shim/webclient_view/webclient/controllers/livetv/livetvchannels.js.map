{"version":3,"sources":["controllers/livetv/livetvchannels.js"],"names":["define","cardBuilder","imageLoader","libraryBrowser","loading","events","view","params","tabContent","getQuery","getPageData","pageData","query","StartIndex","Limit","Fields","renderChannels","context","result","onNextPageClick","isLoading","reloadItems","onPreviousPageClick","querySelector","innerHTML","getQueryPagingHtml","startIndex","limit","totalRecordCount","TotalRecordCount","showLimit","updatePageSizeSetting","filterButton","i","length","elems","html","getChannelsHtml","channels","getCardsHtml","items","shape","showTitle","lazy","cardLayout","showDetailsMenu","showCurrentProgram","showCurrentProgramTime","Items","elem","lazyChildren","querySelectorAll","addEventListener","save","show","apiClient","ApiClient","UserId","getCurrentUserId","getLiveTvChannels","then","hide","require","autoFocuser","autoFocus","showFilterMenu","filterDialogFactory","filterDialog","mode","serverId","on","this","renderTab"],"mappings":"AAAA,aAAAA,OAAO,CAAC,cAAe,cAAe,iBAAkB,UAAW,SAAU,wBAAwB,SAAUC,YAAaC,YAAaC,eAAgBC,QAASC,QAG9J,OAAO,SAAUC,KAAMC,OAAQC,YAe3B,SAASC,WACL,OAfJ,SAASC,cAWL,OAVKC,WACDA,SAAW,CACPC,MAAO,CACHC,WAAY,EACZC,MAAO,IACPC,OAAQ,6BAKbJ,SAIAD,GAAcE,MAgBzB,SAASI,eAAeC,QAASC,QAC7B,SAASC,kBACDC,YAIJR,MAAMC,YAAcD,MAAME,MAC1BO,YAAYJ,UAGhB,SAASK,sBACDF,YAIJR,MAAMC,YAAcD,MAAME,MAC1BO,YAAYJ,UAGhB,IAAIL,MAAQH,WACZQ,QAAQM,cAAc,WAAWC,UAAYrB,eAAesB,mBAAmB,CAC3EC,WAAYd,MAAMC,WAClBc,MAAOf,MAAME,MACbc,iBAAkBV,OAAOW,iBACzBC,WAAW,EACXC,uBAAuB,EACvBC,cAAc,IAElB,IAIIC,EACAC,OACAC,MANAC,KAzCR,SAASC,gBAAgBC,UACrB,OAAOrC,YAAYsC,aAAa,CAC5BC,MAAOF,SACPG,MAAO,SACPC,WAAW,EACXC,MAAM,EACNC,YAAY,EACZC,iBAAiB,EACjBC,oBAAoB,EACpBC,wBAAwB,IAgCjBV,CAAgBnB,OAAO8B,OAC9BC,KAAOhC,QAAQM,cAAc,UAOjC,IANA0B,KAAKzB,UAAYY,KACjBlC,YAAYgD,aAAaD,MAK8BhB,EAAI,EAAGC,QAAzDC,MAAQlB,QAAQkC,iBAAiB,iBAAuCjB,OAAQD,EAAIC,OAAQD,IAC7FE,MAAMF,GAAGmB,iBAAiB,QAASjC,iBAGvC,IAA2Dc,EAAI,EAAGC,QAA7DC,MAAQlB,QAAQkC,iBAAiB,qBAA2CjB,OAAQD,EAAIC,OAAQD,IACjGE,MAAMF,GAAGmB,iBAAiB,QAAS9B,qBAkB3C,SAASD,YAAYJ,QAASoC,MAC1BjD,QAAQkD,OACRlC,WAAY,EACZ,IAAIR,MAAQH,WACR8C,UAAYC,UAChB5C,MAAM6C,OAASF,UAAUG,mBACzBH,UAAUI,kBAAkB/C,OAAOgD,MAAK,SAAU1C,QAC9CF,eAAeC,QAASC,QACxBd,QAAQyD,OACRzC,WAAY,EAEZ0C,QAAQ,CAAC,gBAAgB,SAAUC,aAC/BA,YAAYC,UAAU1D,YAKlC,IAAIK,SAEAS,WAAY,EAChBZ,WAAWe,cAAc,cAAc6B,iBAAiB,SAAS,YAlCjE,SAASa,eAAehD,SACpB6C,QAAQ,CAAC,yCAAyC,SAAUI,qBACxD,IAAIC,aAAe,IAAID,oBAAoB,CACvCtD,MAAOH,WACP2D,KAAM,iBACNC,SAAUb,UAAUa,aAExBhE,OAAOiE,GAAGH,aAAc,gBAAgB,WACpC9C,YAAYJ,YAEhBkD,aAAab,UAyBjBW,CAAezD,eAHR+D,KAMNC,UAAY,WACbnD,YAAYb","file":"livetvchannels.js","sourcesContent":["define([\"cardBuilder\", \"imageLoader\", \"libraryBrowser\", \"loading\", \"events\", \"emby-itemscontainer\"], function (cardBuilder, imageLoader, libraryBrowser, loading, events) {\n    \"use strict\";\n\n    return function (view, params, tabContent) {\n        function getPageData() {\n            if (!pageData) {\n                pageData = {\n                    query: {\n                        StartIndex: 0,\n                        Limit: 100,\n                        Fields: \"PrimaryImageAspectRatio\"\n                    }\n                };\n            }\n\n            return pageData;\n        }\n\n        function getQuery() {\n            return getPageData().query;\n        }\n\n        function getChannelsHtml(channels) {\n            return cardBuilder.getCardsHtml({\n                items: channels,\n                shape: \"square\",\n                showTitle: true,\n                lazy: true,\n                cardLayout: true,\n                showDetailsMenu: true,\n                showCurrentProgram: true,\n                showCurrentProgramTime: true\n            });\n        }\n\n        function renderChannels(context, result) {\n            function onNextPageClick() {\n                if (isLoading) {\n                    return;\n                }\n\n                query.StartIndex += query.Limit;\n                reloadItems(context);\n            }\n\n            function onPreviousPageClick() {\n                if (isLoading) {\n                    return;\n                }\n\n                query.StartIndex -= query.Limit;\n                reloadItems(context);\n            }\n\n            var query = getQuery();\n            context.querySelector(\".paging\").innerHTML = libraryBrowser.getQueryPagingHtml({\n                startIndex: query.StartIndex,\n                limit: query.Limit,\n                totalRecordCount: result.TotalRecordCount,\n                showLimit: false,\n                updatePageSizeSetting: false,\n                filterButton: false\n            });\n            var html = getChannelsHtml(result.Items);\n            var elem = context.querySelector(\"#items\");\n            elem.innerHTML = html;\n            imageLoader.lazyChildren(elem);\n            var i;\n            var length;\n            var elems;\n\n            for (elems = context.querySelectorAll(\".btnNextPage\"), i = 0, length = elems.length; i < length; i++) {\n                elems[i].addEventListener(\"click\", onNextPageClick);\n            }\n\n            for (elems = context.querySelectorAll(\".btnPreviousPage\"), i = 0, length = elems.length; i < length; i++) {\n                elems[i].addEventListener(\"click\", onPreviousPageClick);\n            }\n        }\n\n        function showFilterMenu(context) {\n            require([\"components/filterdialog/filterdialog\"], function (filterDialogFactory) {\n                var filterDialog = new filterDialogFactory({\n                    query: getQuery(),\n                    mode: \"livetvchannels\",\n                    serverId: ApiClient.serverId()\n                });\n                events.on(filterDialog, \"filterchange\", function () {\n                    reloadItems(context);\n                });\n                filterDialog.show();\n            });\n        }\n\n        function reloadItems(context, save) {\n            loading.show();\n            isLoading = true;\n            var query = getQuery();\n            var apiClient = ApiClient;\n            query.UserId = apiClient.getCurrentUserId();\n            apiClient.getLiveTvChannels(query).then(function (result) {\n                renderChannels(context, result);\n                loading.hide();\n                isLoading = false;\n\n                require([\"autoFocuser\"], function (autoFocuser) {\n                    autoFocuser.autoFocus(view);\n                });\n            });\n        }\n\n        var pageData;\n        var self = this;\n        var isLoading = false;\n        tabContent.querySelector(\".btnFilter\").addEventListener(\"click\", function () {\n            showFilterMenu(tabContent);\n        });\n\n        self.renderTab = function () {\n            reloadItems(tabContent);\n        };\n    };\n});\n"]}