{"version":3,"sources":["controllers/userprofilespage.js"],"names":["define","loading","dom","globalize","showUserMenu","elem","card","parentWithClass","page","userId","getAttribute","menuItems","push","name","translate","id","icon","require","actionsheet","show","items","positionTo","callback","Dashboard","navigate","deleteUser","msg","confirm","title","text","confirmText","primary","then","ApiClient","loadData","getUserHtml","user","addConnectIndicator","imgUrl","html","cssClass","Policy","IsDisabled","Id","PrimaryImageTag","getUserImageUrl","width","tag","type","imageClass","Name","lastSeen","getLastSeenText","lastActivityDate","humaneDate","LastActivityDate","renderUsers","users","querySelector","innerHTML","getUserSectionHtml","map","u__q","join","showPendingUserMenu","menuItemId","cancelAuthorization","ajax","url","getUrl","getPendingUserHtml","ImageUrl","UserName","getUsers","hide","renderPendingGuests","length","classList","remove","add","pageIdOn","this","addEventListener","e__e","btnUserMenu","target","e__r"],"mappings":"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","file":"userprofilespage.js","sourcesContent":["define([\"loading\", \"dom\", \"globalize\", \"humanedate\", \"paper-icon-button-light\", \"cardStyle\", \"emby-button\", \"indicators\", \"flexStyles\"], function (loading, dom, globalize) {\n    \"use strict\";\n\n    function deleteUser(page, id) {\n        var msg = globalize.translate(\"DeleteUserConfirmation\");\n\n        require([\"confirm\"], function (confirm) {\n            confirm({\n                title: globalize.translate(\"DeleteUser\"),\n                text: msg,\n                confirmText: globalize.translate(\"ButtonDelete\"),\n                primary: \"delete\"\n            }).then(function () {\n                loading.show();\n                ApiClient.deleteUser(id).then(function () {\n                    loadData(page);\n                });\n            });\n        });\n    }\n\n    function showUserMenu(elem) {\n        var card = dom.parentWithClass(elem, \"card\");\n        var page = dom.parentWithClass(card, \"page\");\n        var userId = card.getAttribute(\"data-userid\");\n        var menuItems = [];\n        menuItems.push({\n            name: globalize.translate(\"ButtonOpen\"),\n            id: \"open\",\n            icon: \"mode_edit\"\n        });\n        menuItems.push({\n            name: globalize.translate(\"ButtonLibraryAccess\"),\n            id: \"access\",\n            icon: \"lock\"\n        });\n        menuItems.push({\n            name: globalize.translate(\"ButtonParentalControl\"),\n            id: \"parentalcontrol\",\n            icon: \"person\"\n        });\n        menuItems.push({\n            name: globalize.translate(\"ButtonDelete\"),\n            id: \"delete\",\n            icon: \"delete\"\n        });\n\n        require([\"actionsheet\"], function (actionsheet) {\n            actionsheet.show({\n                items: menuItems,\n                positionTo: card,\n                callback: function (id) {\n                    switch (id) {\n                        case \"open\":\n                            Dashboard.navigate(\"useredit.html?userId=\" + userId);\n                            break;\n\n                        case \"access\":\n                            Dashboard.navigate(\"userlibraryaccess.html?userId=\" + userId);\n                            break;\n\n                        case \"parentalcontrol\":\n                            Dashboard.navigate(\"userparentalcontrol.html?userId=\" + userId);\n                            break;\n\n                        case \"delete\":\n                            deleteUser(page, userId);\n                    }\n                }\n            });\n        });\n    }\n\n    function getUserHtml(user, addConnectIndicator) {\n        var html = \"\";\n        var cssClass = \"card squareCard scalableCard squareCard-scalable\";\n\n        if (user.Policy.IsDisabled) {\n            cssClass += \" grayscale\";\n        }\n\n        html += \"<div data-userid='\" + user.Id + \"' class='\" + cssClass + \"'>\";\n        html += '<div class=\"cardBox visualCardBox\">';\n        html += '<div class=\"cardScalable visualCardBox-cardScalable\">';\n        html += '<div class=\"cardPadder cardPadder-square\"></div>';\n        html += '<a is=\"emby-linkbutton\" class=\"cardContent\" href=\"useredit.html?userId=' + user.Id + '\">';\n        var imgUrl;\n\n        if (user.PrimaryImageTag) {\n            imgUrl = ApiClient.getUserImageUrl(user.Id, {\n                width: 300,\n                tag: user.PrimaryImageTag,\n                type: \"Primary\"\n            });\n        }\n\n        var imageClass = \"cardImage\";\n\n        if (user.Policy.IsDisabled) {\n            imageClass += \" disabledUser\";\n        }\n\n        if (imgUrl) {\n            html += '<div class=\"' + imageClass + '\" style=\"background-image:url(\\'' + imgUrl + \"');\\\">\";\n        } else {\n            html += '<div class=\"' + imageClass + ' flex align-items-center justify-content-center\">';\n            html += '<i class=\"material-icons cardImageIcon\">person</i>';\n        }\n\n        html += \"</div>\";\n        html += \"</a>\";\n        html += \"</div>\";\n        html += '<div class=\"cardFooter visualCardBox-cardFooter\">';\n        html += '<div class=\"cardText flex align-items-center\">';\n        html += '<div class=\"flex-grow\" style=\"overflow:hidden;text-overflow:ellipsis;\">';\n        html += user.Name;\n        html += \"</div>\";\n        html += '<button type=\"button\" is=\"paper-icon-button-light\" class=\"btnUserMenu flex-shrink-zero\"><i class=\"material-icons more_horiz\"></i></button>';\n        html += \"</div>\";\n        html += '<div class=\"cardText cardText-secondary\">';\n        var lastSeen = getLastSeenText(user.LastActivityDate);\n        html += \"\" != lastSeen ? lastSeen : \"&nbsp;\";\n        html += \"</div>\";\n        html += \"</div>\";\n        html += \"</div>\";\n        return html + \"</div>\";\n    }\n\n    function getLastSeenText(lastActivityDate) {\n        if (lastActivityDate) {\n            return \"Last seen \" + humaneDate(lastActivityDate);\n        }\n\n        return \"\";\n    }\n\n    function getUserSectionHtml(users, addConnectIndicator) {\n        return users.map(function (u__q) {\n            return getUserHtml(u__q, addConnectIndicator);\n        }).join(\"\");\n    }\n\n    function renderUsers(page, users) {\n        page.querySelector(\".localUsers\").innerHTML = getUserSectionHtml(users, true);\n    }\n\n    function showPendingUserMenu(elem) {\n        var menuItems = [];\n        menuItems.push({\n            name: globalize.translate(\"ButtonCancel\"),\n            id: \"delete\",\n            icon: \"delete\"\n        });\n\n        require([\"actionsheet\"], function (actionsheet) {\n            var card = dom.parentWithClass(elem, \"card\");\n            var page = dom.parentWithClass(card, \"page\");\n            var id = card.getAttribute(\"data-id\");\n            actionsheet.show({\n                items: menuItems,\n                positionTo: card,\n                callback: function (menuItemId) {\n                    switch (menuItemId) {\n                        case \"delete\":\n                            cancelAuthorization(page, id);\n                    }\n                }\n            });\n        });\n    }\n\n    function getPendingUserHtml(user) {\n        var html = \"\";\n        html += \"<div data-id='\" + user.Id + \"' class='card squareCard scalableCard squareCard-scalable'>\";\n        html += '<div class=\"cardBox cardBox-bottompadded visualCardBox\">';\n        html += '<div class=\"cardScalable visualCardBox-cardScalable\">';\n        html += '<div class=\"cardPadder cardPadder-square\"></div>';\n        html += '<a class=\"cardContent cardImageContainer\" is=\"emby-linkbutton\" href=\"#\">';\n\n        if (user.ImageUrl) {\n            html += '<div class=\"cardImage\" style=\"background-image:url(\\'' + user.ImageUrl + \"');\\\">\";\n            html += \"</div>\";\n        } else {\n            html += '<i class=\"cardImageIcon material-icons\">person</i>';\n        }\n\n        html += \"</a>\";\n        html += \"</div>\";\n        html += '<div class=\"cardFooter visualCardBox-cardFooter\">';\n        html += '<div class=\"cardText\" style=\"text-align:right; float:right;padding:0;\">';\n        html += '<button type=\"button\" is=\"paper-icon-button-light\" class=\"btnUserMenu\"><i class=\"material-icons more_horiz\"></i></button>';\n        html += \"</div>\";\n        html += '<div class=\"cardText\" style=\"padding-top:10px;padding-bottom:10px;\">';\n        html += user.UserName;\n        html += \"</div>\";\n        html += \"</div>\";\n        html += \"</div>\";\n        return html + \"</div>\";\n    }\n\n    function renderPendingGuests(page, users) {\n        if (users.length) {\n            page.querySelector(\".sectionPendingGuests\").classList.remove(\"hide\");\n        } else {\n            page.querySelector(\".sectionPendingGuests\").classList.add(\"hide\");\n        }\n\n        page.querySelector(\".pending\").innerHTML = users.map(getPendingUserHtml).join(\"\");\n    }\n\n    // TODO cvium: maybe reuse for invitation system\n    function cancelAuthorization(page, id) {\n        loading.show();\n        ApiClient.ajax({\n            type: \"DELETE\",\n            url: ApiClient.getUrl(\"Connect/Pending\", {\n                Id: id\n            })\n        }).then(function () {\n            loadData(page);\n        });\n    }\n\n    function loadData(page) {\n        loading.show();\n        ApiClient.getUsers().then(function (users) {\n            renderUsers(page, users);\n            loading.hide();\n        });\n        // TODO cvium\n        renderPendingGuests(page, []);\n        // ApiClient.getJSON(ApiClient.getUrl(\"Connect/Pending\")).then(function (pending) {\n        //\n        // });\n    }\n\n    function showInvitePopup(page) {\n        require([\"components/guestinviter/guestinviter\"], function (guestinviter) {\n            guestinviter.show().then(function () {\n                loadData(page);\n            });\n        });\n    }\n\n    pageIdOn(\"pageinit\", \"userProfilesPage\", function () {\n        var page = this;\n        page.querySelector(\".btnAddUser\").addEventListener(\"click\", function() {\n            Dashboard.navigate(\"usernew.html\");\n        });\n        page.querySelector(\".localUsers\").addEventListener(\"click\", function (e__e) {\n            var btnUserMenu = dom.parentWithClass(e__e.target, \"btnUserMenu\");\n\n            if (btnUserMenu) {\n                showUserMenu(btnUserMenu);\n            }\n        });\n        page.querySelector(\".pending\").addEventListener(\"click\", function (e__r) {\n            var btnUserMenu = dom.parentWithClass(e__r.target, \"btnUserMenu\");\n\n            if (btnUserMenu) {\n                showPendingUserMenu(btnUserMenu);\n            }\n        });\n    });\n    pageIdOn(\"pagebeforeshow\", \"userProfilesPage\", function () {\n        loadData(this);\n    });\n});\n"]}