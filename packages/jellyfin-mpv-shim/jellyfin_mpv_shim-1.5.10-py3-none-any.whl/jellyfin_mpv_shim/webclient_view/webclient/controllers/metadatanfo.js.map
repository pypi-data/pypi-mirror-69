{"version":3,"sources":["controllers/metadatanfo.js"],"names":["define","$","loading","libraryMenu","onSubmit","show","form","this","ApiClient","getNamedConfiguration","metadataKey","then","config","UserId","val","ReleaseDateFormat","SaveImagePathsInNfo","querySelector","checked","EnablePathSubstitution","EnableExtraThumbsDuplication","updateNamedConfiguration","Dashboard","processServerConfigurationUpdateResult","showConfirmMessage","msg","push","Globalize","translate","require","alert","text","join","getTabs","href","name","document","on","off","setTabs","page","promise1","getUsers","promise2","Promise","all","responses","loadPage","users","html","map","user","Id","Name","hide"],"mappings":"AAAA,aAAAA,OAAO,CAAC,SAAU,UAAW,gBAAgB,SAAUC,EAAGC,QAASC,aAgB/D,SAASC,WACLF,QAAQG,OACR,IAAIC,KAAOC,KAYX,OAXAC,UAAUC,sBAAsBC,aAAaC,MAAK,SAAUC,QACxDA,OAAOC,OAASZ,EAAE,cAAeK,MAAMQ,OAAS,KAChDF,OAAOG,kBAAoBd,EAAE,2BAA4BK,MAAMQ,MAC/DF,OAAOI,oBAAsBV,KAAKW,cAAc,sBAAsBC,QACtEN,OAAOO,uBAAyBb,KAAKW,cAAc,8BAA8BC,QACjFN,OAAOQ,6BAA+Bd,KAAKW,cAAc,yBAAyBC,QAClFV,UAAUa,yBAAyBX,YAAaE,QAAQD,MAAK,WACzDW,UAAUC,yCAOtB,SAASC,mBAAmBZ,QACxB,IAAIa,IAAM,GACVA,IAAIC,KAAKC,UAAUC,UAAU,8BAE7BC,QAAQ,CAAC,UAAU,SAAUC,OACzBA,MAAM,CACFC,KAAMN,IAAIO,KAAK,mBAZfR,UAGD,EAcX,SAASS,UACL,MAAO,CAAC,CACJC,KAAM,eACNC,KAAMR,UAAUC,UAAU,oBAC3B,CACCM,KAAM,sBACNC,KAAMR,UAAUC,UAAU,eAC3B,CACCM,KAAM,sBACNC,KAAMR,UAAUC,UAAU,gBAC3B,CACCM,KAAM,mBACNC,KAAMR,UAAUC,UAAU,oBAIlC,IAAIlB,YAAc,eAClBT,EAAEmC,UAAUC,GAAG,WAAY,oBAAoB,WAC3CpC,EAAE,oBAAoBqC,IAAI,SAAUlC,UAAUiC,GAAG,SAAUjC,aAC5DiC,GAAG,WAAY,oBAAoB,WAClClC,YAAYoC,QAAQ,WAAY,EAAGN,SACnC/B,QAAQG,OACR,IAAImC,KAAOjC,KACPkC,SAAWjC,UAAUkC,WACrBC,SAAWnC,UAAUC,sBAAsBC,aAC/CkC,QAAQC,IAAI,CAACJ,SAAUE,WAAWhC,MAAK,SAAUmC,YAlErD,SAASC,SAASP,KAAM5B,OAAQoC,OAC5B,IAAIC,KAAO,wCAA0CtB,UAAUC,UAAU,cAAgB,YACzFqB,MAAQD,MAAME,KAAI,SAAUC,MACxB,MAAO,kBAAoBA,KAAKC,GAAK,KAAOD,KAAKE,KAAO,eACzDrB,KAAK,IACR/B,EAAE,cAAeuC,MAAMS,KAAKA,MAAMnC,IAAIF,OAAOC,QAAU,IACvDZ,EAAE,2BAA4BuC,MAAM1B,IAAIF,OAAOG,mBAC/CyB,KAAKvB,cAAc,sBAAsBC,QAAUN,OAAOI,oBAC1DwB,KAAKvB,cAAc,8BAA8BC,QAAUN,OAAOO,uBAClEqB,KAAKvB,cAAc,yBAAyBC,QAAUN,OAAOQ,6BAC7DlB,QAAQoD,OAyDJP,CAASP,KAAMM,UAAU,GAAIA,UAAU","file":"metadatanfo.js","sourcesContent":["define([\"jQuery\", \"loading\", \"libraryMenu\"], function ($, loading, libraryMenu) {\n    \"use strict\";\n\n    function loadPage(page, config, users) {\n        var html = '<option value=\"\" selected=\"selected\">' + Globalize.translate(\"OptionNone\") + \"</option>\";\n        html += users.map(function (user) {\n            return '<option value=\"' + user.Id + '\">' + user.Name + \"</option>\";\n        }).join(\"\");\n        $(\"#selectUser\", page).html(html).val(config.UserId || \"\");\n        $(\"#selectReleaseDateFormat\", page).val(config.ReleaseDateFormat);\n        page.querySelector(\"#chkSaveImagePaths\").checked = config.SaveImagePathsInNfo;\n        page.querySelector(\"#chkEnablePathSubstitution\").checked = config.EnablePathSubstitution;\n        page.querySelector(\"#chkEnableExtraThumbs\").checked = config.EnableExtraThumbsDuplication;\n        loading.hide();\n    }\n\n    function onSubmit() {\n        loading.show();\n        var form = this;\n        ApiClient.getNamedConfiguration(metadataKey).then(function (config) {\n            config.UserId = $(\"#selectUser\", form).val() || null;\n            config.ReleaseDateFormat = $(\"#selectReleaseDateFormat\", form).val();\n            config.SaveImagePathsInNfo = form.querySelector(\"#chkSaveImagePaths\").checked;\n            config.EnablePathSubstitution = form.querySelector(\"#chkEnablePathSubstitution\").checked;\n            config.EnableExtraThumbsDuplication = form.querySelector(\"#chkEnableExtraThumbs\").checked;\n            ApiClient.updateNamedConfiguration(metadataKey, config).then(function () {\n                Dashboard.processServerConfigurationUpdateResult();\n                showConfirmMessage(config);\n            });\n        });\n        return false;\n    }\n\n    function showConfirmMessage(config) {\n        var msg = [];\n        msg.push(Globalize.translate(\"MetadataSettingChangeHelp\"));\n\n        require([\"alert\"], function (alert) {\n            alert({\n                text: msg.join(\"<br/><br/>\")\n            });\n        });\n    }\n\n    function getTabs() {\n        return [{\n            href: \"library.html\",\n            name: Globalize.translate(\"HeaderLibraries\")\n        }, {\n            href: \"librarydisplay.html\",\n            name: Globalize.translate(\"TabDisplay\")\n        }, {\n            href: \"metadataimages.html\",\n            name: Globalize.translate(\"TabMetadata\")\n        }, {\n            href: \"metadatanfo.html\",\n            name: Globalize.translate(\"TabNfoSettings\")\n        }];\n    }\n\n    var metadataKey = \"xbmcmetadata\";\n    $(document).on(\"pageinit\", \"#metadataNfoPage\", function () {\n        $(\".metadataNfoForm\").off(\"submit\", onSubmit).on(\"submit\", onSubmit);\n    }).on(\"pageshow\", \"#metadataNfoPage\", function () {\n        libraryMenu.setTabs(\"metadata\", 3, getTabs);\n        loading.show();\n        var page = this;\n        var promise1 = ApiClient.getUsers();\n        var promise2 = ApiClient.getNamedConfiguration(metadataKey);\n        Promise.all([promise1, promise2]).then(function (responses) {\n            loadPage(page, responses[1], responses[0]);\n        });\n    });\n});\n"]}