{"version":3,"sources":["elements/emby-slider/emby-slider.js"],"names":["define","browser","dom","layoutManager","keyboardnavigation","EmbySliderPrototype","Object","create","HTMLInputElement","prototype","supportsValueSetOverride","getOwnPropertyDescriptor","defineProperty","descriptor","configurable","mapClientToFraction","range","clientX","rect","sliderBubbleTrack","getBoundingClientRect","fraction","left","width","valueRange","max","min","step","Math","round","mapFractionToValue","value","parseFloat","updateValues","isValueSet","this","keyboardDragging","touched","cancelAnimationFrame","updateValuesFrame","requestAnimationFrame","backgroundLower","style","updateBubble","bubble","bubbleText","bubbleTrackRect","bubbleRect","bubblePos","getBubbleHtml","getBubbleText","toLocaleString","innerHTML","attachedCallback","getAttribute","enableWidthWithTransform","setAttribute","classList","add","noFlex","edge","msie","mobile","tv","containerElement","parentNode","htmlToInsert","insertAdjacentHTML","querySelector","backgroundUpper","sliderBubble","hasHideClass","contains","addEventListener","e","dragging","dataset","sliderKeepProgress","call","mapValueToFraction","remove","passive","window","PointerEvent","iOS","targetTouches","length","dispatchEvent","Event","bubbles","cancelable","preventDefault","capture","setTimeout","bind","startInterval","interval","clearInterval","setInterval","keyboardDraggingTimer","startKeyboardDragging","elem","clearTimeout","finishKeyboardDragging","undefined","event","stepKeyboard","delta","onKeyDown","getKeyName","keyboardStepDown","stopPropagation","keyboardStepUp","setRange","startPercent","endPercent","widthPercent","enableKeyboardDragging","keyboardDraggingEnabled","setKeyboardSteps","stepDown","stepUp","setBufferedRanges","ranges","runtime","position","mapRangesFromRuntimeToPercent","map","r","start","end","i","setIsClear","isClear","detachedCallback","document","registerElement","extends"],"mappings":"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","file":"emby-slider.js","sourcesContent":["define(['browser', 'dom', 'layoutManager', 'keyboardnavigation', 'css!./emby-slider', 'registerElement', 'emby-input'], function (browser, dom, layoutManager, keyboardnavigation) {\n    'use strict';\n\n    var EmbySliderPrototype = Object.create(HTMLInputElement.prototype);\n\n    var supportsValueSetOverride = false;\n\n    var enableWidthWithTransform;\n\n    if (Object.getOwnPropertyDescriptor && Object.defineProperty) {\n\n        var descriptor = Object.getOwnPropertyDescriptor(HTMLInputElement.prototype, 'value');\n        // descriptor returning null in webos\n        if (descriptor && descriptor.configurable) {\n            supportsValueSetOverride = true;\n        }\n    }\n\n    /**\n     * Returns slider fraction corresponding to client position.\n     *\n     * @param {Object} range slider itself\n     * @param {number} clientX client X-coordinate\n     * @return {number} slider fraction\n     */\n    function mapClientToFraction(range, clientX) {\n        var rect = range.sliderBubbleTrack.getBoundingClientRect();\n\n        var fraction = (clientX - rect.left) / rect.width;\n\n        // Snap to step\n        var valueRange = range.max - range.min;\n        if (range.step !== 'any' && valueRange !== 0) {\n            var step = (range.step || 1) / valueRange;\n            fraction = Math.round(fraction / step) * step;\n        }\n\n        return Math.min(Math.max(fraction, 0), 1);\n    }\n\n    /**\n     * Returns slider value corresponding to slider fraction.\n     *\n     * @param {Object} range slider itself\n     * @param {number} fraction slider fraction\n     * @return {number} slider value\n     */\n    function mapFractionToValue(range, fraction) {\n        var value = (range.max - range.min) * fraction;\n\n        // Snap to step\n        if (range.step !== 'any') {\n            var step = range.step || 1;\n            value = Math.round(value / step) * step;\n        }\n\n        value += parseFloat(range.min);\n\n        return Math.min(Math.max(value, range.min), range.max);\n    }\n\n    /**\n     * Returns slider fraction corresponding to slider value.\n     *\n     * @param {Object} range slider itself\n     * @param {number} value slider value (snapped to step)\n     * @return {number} slider fraction\n     */\n    function mapValueToFraction(range, value) {\n        var valueRange = range.max - range.min;\n        var fraction = valueRange !== 0 ? (value - range.min) / valueRange : 0;\n        return Math.min(Math.max(fraction, 0), 1);\n    }\n\n    /**\n     * Updates progress bar.\n     *\n     * @param {boolean} [isValueSet] update by 'valueset' event or by timer\n     */\n    function updateValues(isValueSet) {\n\n        // Do not update values by 'valueset' in case of soft-implemented dragging\n        if (!!isValueSet && (!!this.keyboardDragging || !!this.touched)) {\n            return;\n        }\n\n        var range = this;\n        var value = range.value;\n\n        // put this on a callback. Doing it within the event sometimes causes the slider to get hung up and not respond\n        // Keep only one per slider frame request\n        cancelAnimationFrame(range.updateValuesFrame);\n        range.updateValuesFrame = requestAnimationFrame(function () {\n\n            var backgroundLower = range.backgroundLower;\n\n            if (backgroundLower) {\n                var fraction = (value - range.min) / (range.max - range.min);\n\n                if (enableWidthWithTransform) {\n                    backgroundLower.style.transform = 'scaleX(' + (fraction) + ')';\n                } else {\n                    fraction *= 100;\n                    backgroundLower.style.width = fraction + '%';\n                }\n            }\n        });\n    }\n\n    function updateBubble(range, value, bubble, bubbleText) {\n\n        requestAnimationFrame(function () {\n            var bubbleTrackRect = range.sliderBubbleTrack.getBoundingClientRect();\n            var bubbleRect = bubble.getBoundingClientRect();\n\n            var bubblePos = bubbleTrackRect.width * value / 100;\n            bubblePos = Math.min(Math.max(bubblePos, bubbleRect.width / 2), bubbleTrackRect.width - bubbleRect.width / 2);\n\n            bubble.style.left = bubblePos + 'px';\n\n            if (range.getBubbleHtml) {\n                value = range.getBubbleHtml(value);\n            } else {\n                if (range.getBubbleText) {\n                    value = range.getBubbleText(value);\n                } else {\n                    value = mapFractionToValue(range, value / 100).toLocaleString();\n                }\n                value = '<h1 class=\"sliderBubbleText\">' + value + '</h1>';\n            }\n\n            bubble.innerHTML = value;\n        });\n    }\n\n    EmbySliderPrototype.attachedCallback = function () {\n\n        if (this.getAttribute('data-embyslider') === 'true') {\n            return;\n        }\n\n        if (enableWidthWithTransform == null) {\n            //enableWidthWithTransform = browser.supportsCssAnimation();\n        }\n\n        this.setAttribute('data-embyslider', 'true');\n\n        this.classList.add('mdl-slider');\n        this.classList.add('mdl-js-slider');\n\n        if (browser.noFlex) {\n            this.classList.add('slider-no-webkit-thumb');\n        }\n        if (browser.edge || browser.msie) {\n            this.classList.add('slider-browser-edge');\n        }\n        if (!layoutManager.mobile) {\n            this.classList.add('mdl-slider-hoverthumb');\n        }\n        if (layoutManager.tv) {\n            this.classList.add('show-focus');\n        }\n\n        var containerElement = this.parentNode;\n        containerElement.classList.add('mdl-slider-container');\n\n        var htmlToInsert = '';\n\n        htmlToInsert += '<div class=\"mdl-slider-background-flex-container\">';\n        htmlToInsert += '<div class=\"mdl-slider-background-flex\">';\n        htmlToInsert += '<div class=\"mdl-slider-background-flex-inner\">';\n\n        // the more of these, the more ranges we can display\n        htmlToInsert += '<div class=\"mdl-slider-background-upper\"></div>';\n\n        if (enableWidthWithTransform) {\n            htmlToInsert += '<div class=\"mdl-slider-background-lower mdl-slider-background-lower-withtransform\"></div>';\n        } else {\n            htmlToInsert += '<div class=\"mdl-slider-background-lower\"></div>';\n        }\n\n        htmlToInsert += '</div>';\n        htmlToInsert += '</div>';\n        htmlToInsert += '</div>';\n\n        htmlToInsert += '<div class=\"sliderBubbleTrack\"><div class=\"sliderBubble hide\"></div></div>';\n\n        containerElement.insertAdjacentHTML('beforeend', htmlToInsert);\n\n        this.sliderBubbleTrack = containerElement.querySelector('.sliderBubbleTrack');\n        this.backgroundLower = containerElement.querySelector('.mdl-slider-background-lower');\n        this.backgroundUpper = containerElement.querySelector('.mdl-slider-background-upper');\n        var sliderBubble = containerElement.querySelector('.sliderBubble');\n\n        var hasHideClass = sliderBubble.classList.contains('hide');\n\n        dom.addEventListener(this, 'input', function (e) {\n            this.dragging = true;\n\n            if (this.dataset.sliderKeepProgress !== 'true') {\n                updateValues.call(this);\n            }\n\n            var bubbleValue = mapValueToFraction(this, this.value) * 100;\n            updateBubble(this, bubbleValue, sliderBubble);\n\n            if (hasHideClass) {\n                sliderBubble.classList.remove('hide');\n                hasHideClass = false;\n            }\n        }, {\n            passive: true\n        });\n\n        dom.addEventListener(this, 'change', function () {\n            this.dragging = false;\n\n            if (this.dataset.sliderKeepProgress === 'true') {\n                updateValues.call(this);\n            }\n\n            sliderBubble.classList.add('hide');\n            hasHideClass = true;\n\n        }, {\n            passive: true\n        });\n\n        dom.addEventListener(this, (window.PointerEvent ? 'pointermove' : 'mousemove'), function (e) {\n\n            if (!this.dragging) {\n                var bubbleValue = mapClientToFraction(this, e.clientX) * 100;\n\n                updateBubble(this, bubbleValue, sliderBubble);\n\n                if (hasHideClass) {\n                    sliderBubble.classList.remove('hide');\n                    hasHideClass = false;\n                }\n            }\n\n        }, {\n            passive: true\n        });\n\n        dom.addEventListener(this, (window.PointerEvent ? 'pointerleave' : 'mouseleave'), function () {\n            sliderBubble.classList.add('hide');\n            hasHideClass = true;\n        }, {\n            passive: true\n        });\n\n        // HACK: iPhone/iPad do not change input by touch\n        if (browser.iOS) {\n            dom.addEventListener(this, 'touchstart', function (e) {\n                if (e.targetTouches.length !== 1) {\n                    return;\n                }\n\n                this.touched = true;\n\n                var fraction = mapClientToFraction(this, e.targetTouches[0].clientX);\n                this.value = mapFractionToValue(this, fraction);\n\n                this.dispatchEvent(new Event('input', {\n                    bubbles: true,\n                    cancelable: false\n                }));\n\n                // Prevent 'pointermove' and 'click' after 'touch*'\n                // FIXME: Still have some 'pointermove' and 'click' that bypass 'touchstart'\n                e.preventDefault();\n            }, {\n                capture: true\n            });\n\n            dom.addEventListener(this, 'touchmove', function (e) {\n                if (!this.touched || e.targetTouches.length !== 1) {\n                    return;\n                }\n\n                var fraction = mapClientToFraction(this, e.targetTouches[0].clientX);\n                this.value = mapFractionToValue(this, fraction);\n\n                this.dispatchEvent(new Event('input', {\n                    bubbles: true,\n                    cancelable: false\n                }));\n            }, {\n                passive: true\n            });\n\n            dom.addEventListener(this, 'touchend', function (e) {\n                var range = this;\n\n                setTimeout(function () {\n                    range.touched = false;\n\n                    range.dispatchEvent(new Event('change', {\n                        bubbles: true,\n                        cancelable: false\n                    }));\n                }, 0);\n            }, {\n                passive: true\n            });\n        }\n\n        if (supportsValueSetOverride) {\n            this.addEventListener('valueset', updateValues.bind(this, true));\n        } else {\n            startInterval(this);\n        }\n    };\n\n    /**\n     * Keyboard dragging timeout.\n     * After this delay \"change\" event will be fired.\n     */\n    var KeyboardDraggingTimeout = 1000;\n\n    /**\n     * Keyboard dragging timer.\n     */\n    var keyboardDraggingTimer;\n\n    /**\n     * Start keyboard dragging.\n     *\n     * @param {Object} elem slider itself\n     */\n    function startKeyboardDragging(elem) {\n        elem.keyboardDragging = true;\n\n        clearTimeout(keyboardDraggingTimer);\n        keyboardDraggingTimer = setTimeout(function () {\n            finishKeyboardDragging(elem);\n        }, KeyboardDraggingTimeout);\n    }\n\n    /**\n     * Finish keyboard dragging.\n     *\n     * @param {Object} elem slider itself\n     */\n    function finishKeyboardDragging(elem) {\n        clearTimeout(keyboardDraggingTimer);\n        keyboardDraggingTimer = undefined;\n\n        elem.keyboardDragging = false;\n\n        var event = new Event('change', {\n            bubbles: true,\n            cancelable: false\n        });\n        elem.dispatchEvent(event);\n    }\n\n    /**\n     * Do step by delta.\n     *\n     * @param {Object} elem slider itself\n     * @param {number} delta step amount\n     */\n    function stepKeyboard(elem, delta) {\n        startKeyboardDragging(elem);\n\n        elem.value = Math.max(elem.min, Math.min(elem.max, parseFloat(elem.value) + delta));\n\n        var event = new Event('input', {\n            bubbles: true,\n            cancelable: false\n        });\n        elem.dispatchEvent(event);\n    }\n\n    /**\n     * Handle KeyDown event\n     */\n    function onKeyDown(e) {\n        switch (keyboardnavigation.getKeyName(e)) {\n            case 'ArrowLeft':\n            case 'Left':\n                stepKeyboard(this, -this.keyboardStepDown || -1);\n                e.preventDefault();\n                e.stopPropagation();\n                break;\n            case 'ArrowRight':\n            case 'Right':\n                stepKeyboard(this, this.keyboardStepUp || 1);\n                e.preventDefault();\n                e.stopPropagation();\n                break;\n        }\n    }\n\n    /**\n     * Enable keyboard dragging.\n     */\n    EmbySliderPrototype.enableKeyboardDragging = function () {\n        if (!this.keyboardDraggingEnabled) {\n            this.addEventListener('keydown', onKeyDown);\n            this.keyboardDraggingEnabled = true;\n        }\n    }\n\n    /**\n     * Set steps for keyboard input.\n     *\n     * @param {number} stepDown step to reduce\n     * @param {number} stepUp step to increase\n     */\n    EmbySliderPrototype.setKeyboardSteps = function (stepDown, stepUp) {\n        this.keyboardStepDown = stepDown || stepUp || 1;\n        this.keyboardStepUp = stepUp || stepDown || 1;\n    }\n\n    function setRange(elem, startPercent, endPercent) {\n\n        var style = elem.style;\n        style.left = Math.max(startPercent, 0) + '%';\n\n        var widthPercent = endPercent - startPercent;\n        style.width = Math.max(Math.min(widthPercent, 100), 0) + '%';\n    }\n\n    function mapRangesFromRuntimeToPercent(ranges, runtime) {\n\n        if (!runtime) {\n            return [];\n        }\n\n        return ranges.map(function (r) {\n\n            return {\n                start: (r.start / runtime) * 100,\n                end: (r.end / runtime) * 100\n            };\n        });\n    }\n\n    EmbySliderPrototype.setBufferedRanges = function (ranges, runtime, position) {\n\n        var elem = this.backgroundUpper;\n        if (!elem) {\n            return;\n        }\n\n        if (runtime != null) {\n            ranges = mapRangesFromRuntimeToPercent(ranges, runtime);\n\n            position = (position / runtime) * 100;\n        }\n\n        for (var i = 0, length = ranges.length; i < length; i++) {\n\n            var range = ranges[i];\n\n            if (position != null) {\n                if (position >= range.end) {\n                    continue;\n                }\n            }\n\n            setRange(elem, range.start, range.end);\n            return;\n        }\n\n        setRange(elem, 0, 0);\n    };\n\n    EmbySliderPrototype.setIsClear = function (isClear) {\n\n        var backgroundLower = this.backgroundLower;\n        if (backgroundLower) {\n            if (isClear) {\n                backgroundLower.classList.add('mdl-slider-background-lower-clear');\n            } else {\n                backgroundLower.classList.remove('mdl-slider-background-lower-clear');\n            }\n        }\n    };\n\n    function startInterval(range) {\n        var interval = range.interval;\n        if (interval) {\n            clearInterval(interval);\n        }\n        range.interval = setInterval(updateValues.bind(range, true), 100);\n    }\n\n    EmbySliderPrototype.detachedCallback = function () {\n\n        var interval = this.interval;\n        if (interval) {\n            clearInterval(interval);\n        }\n        this.interval = null;\n        this.backgroundUpper = null;\n        this.backgroundLower = null;\n    };\n\n    document.registerElement('emby-slider', {\n        prototype: EmbySliderPrototype,\n        extends: 'input'\n    });\n});\n"]}