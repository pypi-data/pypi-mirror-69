import os
import sys
import json
import base64
import argparse

from IPython.utils.tempdir import TemporaryDirectory
from jupyter_client.kernelspec import KernelSpecManager

kernel_logo = b'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'
kernel_json = {"argv":[sys.executable, "-m", "elasticsearch_kernel", "-f", "{connection_file}"],
               "display_name":"Elasticsearch",
               "language":"sql"}

def install_my_kernel_spec(user=True, prefix=None):
    with TemporaryDirectory() as td:
        os.chmod(td, 0o755)
        with open(os.path.join(td, 'kernel.json'), 'w') as f:
            json.dump(kernel_json, f, sort_keys=True)
        with open(os.path.join(td, 'logo-64x64.png'), 'wb') as f:
            f.write(base64.b64decode(kernel_logo))
        print('Installing Jupyter Elasticsearch kernel spec.')
        KernelSpecManager().install_kernel_spec(td, 'Elasticsearch', user=user, replace=True, prefix=prefix)

def _is_root():
    try:
        return os.geteuid()==0
    except AttributeError:
        return False

def main(argv=None):
    parser = argparse.ArgumentParser(description='Install Jupyter KernelSpec for Elasticsearch Kernel.')
    prefix_locations = parser.add_mutually_exclusive_group()
    prefix_locations.add_argument('--user',
                                  help='Install Jupyter Elasticsearch KernelSpec in user homedirectory.',
                                  action='store_true')
    prefix_locations.add_argument('--sys-prefix',
                                  help='Install Jupyter Elasticsearch KernelSpec in sys.prefix. Useful in conda / virtualenv',
                                  action='store_true',
                                  dest='sys_prefix')
    prefix_locations.add_argument('--prefix',
                                  help='Install Jupyter Elasticsearch KernelSpec in this prefix',
                                  default=None)
    args = parser.parse_args(argv)

    user = False
    prefix = None
    if args.sys_prefix:
        prefix = sys.prefix
    elif args.prefix:
        prefix = args.prefix
    elif args.user or not _is_root():
        user = True

    install_my_kernel_spec(user=user, prefix=prefix)

if __name__ == '__main__':
    main()
